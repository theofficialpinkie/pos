<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Weekly Dashboard</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      background: #ffffff;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', 'Arial', sans-serif;
      color: #000000;
      overflow-x: hidden;
      min-height: 100vh;
    }

    /* Single Page Layout - Centered Header */
    .dashboard-header {
      max-width: 1200px;
      margin: 0 auto;
      padding: 80px 60px 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      position: relative;
    }

    .current-day-header {
      font-size: 1.8rem;
      font-weight: 300;
      letter-spacing: -1px;
      color: #000000;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }

    .day-name {
      font-size: 1.8rem;
      font-weight: 300;
      letter-spacing: -1px;
    }

    .date-range {
      font-size: 0.65rem;
      font-weight: 500;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: rgba(0, 0, 0, 0.4);
    }

    .day-nav-btn {
      background: transparent;
      border: none;
      color: rgba(0, 0, 0, 0.3);
      padding: 4px 8px;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.3s;
      border-radius: 4px;
    }

    .day-nav-btn:hover {
      color: rgba(0, 0, 0, 0.7);
      background: rgba(0, 0, 0, 0.03);
    }

    .back-btn {
      position: absolute;
      right: 60px;
      background: transparent;
      border: 1px solid rgba(0, 0, 0, 0.15);
      color: rgba(0, 0, 0, 0.7);
      padding: 8px 20px;
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.3s;
      border-radius: 4px;
      font-weight: 500;
      text-decoration: none;
      display: inline-block;
      letter-spacing: 0.5px;
      text-transform: uppercase;
    }

    .back-btn:hover {
      background: rgba(0, 0, 0, 0.03);
      border-color: rgba(0, 0, 0, 0.3);
      transform: translateY(-1px);
    }

    /* Main Container */
    .main-container {
      padding-top: 20px;
      max-width: 1400px;
      margin: 0 auto;
      padding-left: 120px;
      padding-right: 120px;
      padding-bottom: 60px;
    }

    /* Goals Grid - Always visible on right (or full width when empty) */
    .goals-empty-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      grid-auto-rows: 140px;
      grid-auto-flow: dense;
      gap: 0;
      border-radius: 12px;
      overflow: hidden;
      min-height: 280px;
    }

    /* Larger grid when empty state - more visual impact */
    .goals-empty-grid-large {
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      grid-auto-rows: 140px;
      grid-auto-flow: dense;
      gap: 0;
      border-radius: 12px;
      overflow: hidden;
      min-height: 280px;
      max-width: 900px;
      margin: 0 auto;
    }

    .goal-empty-card {
      background-size: cover;
      background-position: center;
      position: relative;
      cursor: pointer;
      transition: all 0.3s;
      /* LESS greyscale - more color visible */
      filter: grayscale(0.5) brightness(1.1);
      -webkit-filter: grayscale(0.5) brightness(1.1); /* Safari/Chrome prefix */
      overflow: hidden;
      min-height: 120px; /* Chrome fix - explicit min-height */
      width: 100%; /* Chrome fix - explicit width */
    }

    .goal-empty-card:hover {
      transform: scale(1.02);
      filter: grayscale(0.3) brightness(1.05);
      -webkit-filter: grayscale(0.3) brightness(1.05);
      z-index: 10;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    }

    .goal-empty-card.no-image {
      background: #fafafa;
      border: 1px solid rgba(0, 0, 0, 0.06);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 20px;
      filter: none;
      -webkit-filter: none;
    }

    .goal-empty-card.no-image:hover {
      background: #f5f5f5;
      border-color: rgba(0, 0, 0, 0.1);
      transform: scale(1.02);
    }

    /* Mosaic layout - 4 columns (right side) - COHESIVE varied sizes */
    .goals-empty-card:nth-child(1) { grid-column: span 2; grid-row: span 2; }
    .goals-empty-card:nth-child(2) { grid-column: span 2; grid-row: span 1; }
    .goals-empty-card:nth-child(3) { grid-column: span 2; grid-row: span 1; }
    .goals-empty-card:nth-child(4) { grid-column: span 2; grid-row: span 2; }
    .goals-empty-card:nth-child(5) { grid-column: span 2; grid-row: span 1; }
    .goals-empty-card:nth-child(6) { grid-column: span 2; grid-row: span 1; }
    .goals-empty-card:nth-child(7) { grid-column: span 2; grid-row: span 1; }
    .goals-empty-card:nth-child(8) { grid-column: span 2; grid-row: span 1; }
    .goals-empty-card:nth-child(n+9) { grid-column: span 1; grid-row: span 1; }

    /* 6 columns - LARGE empty state grid - bigger impact */
    .goals-empty-grid-large .goal-empty-card:nth-child(1) { grid-column: span 3; grid-row: span 2; }
    .goals-empty-grid-large .goal-empty-card:nth-child(2) { grid-column: span 2; grid-row: span 1; }
    .goals-empty-grid-large .goal-empty-card:nth-child(3) { grid-column: span 1; grid-row: span 1; }
    .goals-empty-grid-large .goal-empty-card:nth-child(4) { grid-column: span 2; grid-row: span 2; }
    .goals-empty-grid-large .goal-empty-card:nth-child(5) { grid-column: span 1; grid-row: span 1; }
    .goals-empty-grid-large .goal-empty-card:nth-child(6) { grid-column: span 3; grid-row: span 1; }
    .goals-empty-grid-large .goal-empty-card:nth-child(7) { grid-column: span 2; grid-row: span 1; }
    .goals-empty-grid-large .goal-empty-card:nth-child(8) { grid-column: span 2; grid-row: span 1; }
    .goals-empty-grid-large .goal-empty-card:nth-child(9) { grid-column: span 2; grid-row: span 1; }
    .goals-empty-grid-large .goal-empty-card:nth-child(n+10) { grid-column: span 2; grid-row: span 1; }

    .goal-empty-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(to top, rgba(0, 0, 0, 0.6) 0%, rgba(0, 0, 0, 0.1) 50%, transparent 100%);
      opacity: 1;
    }

    .goal-empty-card.no-image::before {
      display: none;
    }

    .goal-empty-checkbox {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 18px;
      height: 18px;
      cursor: pointer;
      z-index: 10;
      accent-color: #ffffff;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.4));
    }

    .goal-empty-card.no-image .goal-empty-checkbox {
      accent-color: #000000;
      filter: none;
    }

    .goal-empty-content {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 12px;
      z-index: 2;
    }

    .goal-empty-card.no-image .goal-empty-content {
      position: static;
      text-align: center;
    }

    .goal-empty-name {
      font-size: 0.8rem;
      font-weight: 500;
      color: #ffffff;
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.6);
      line-height: 1.2;
    }

    .goal-empty-card.no-image .goal-empty-name {
      color: #000000;
      text-shadow: none;
      font-size: 0.75rem;
    }

    .goal-empty-add-image {
      font-size: 0.65rem;
      color: rgba(255, 255, 255, 0.8);
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
      margin-top: 4px;
    }

    .goal-empty-card.no-image .goal-empty-add-image {
      color: rgba(0, 0, 0, 0.3);
      text-shadow: none;
      margin-top: 6px;
    }

    .goal-empty-placeholder-icon {
      font-size: 1.5rem;
      margin-bottom: 8px;
      color: rgba(0, 0, 0, 0.15);
      font-weight: 200;
    }

    .goal-empty-card.completed {
      filter: grayscale(0.9) brightness(1.2) opacity(0.6);
    }

    .goal-empty-card.completed::after {
      content: '‚úì';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 2.5rem;
      font-weight: 200;
      color: #ffffff;
      z-index: 3;
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
    }

    .goal-empty-card.completed::after {
      color: #000000;
      text-shadow: none;
      font-size: 2rem;
    }

    /* In Progress Indicator - Green Pulsing Dot */
    .goal-in-progress-indicator {
      position: absolute;
      top: 10px;
      left: 10px;
      width: 8px;
      height: 8px;
      background: #10b981;
      border-radius: 50%;
      z-index: 11;
      animation: pulse-green 2s ease-in-out infinite;
      box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
    }

    @keyframes pulse-green {
      0%, 100% {
        box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
      }
      50% {
        box-shadow: 0 0 0 8px rgba(16, 185, 129, 0);
      }
    }

    .goal-in-progress-label {
      position: absolute;
      top: 10px;
      left: 24px;
      font-size: 0.6rem;
      font-weight: 500;
      color: #10b981;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
      z-index: 11;
      letter-spacing: 0.5px;
      text-transform: uppercase;
    }

    .goal-empty-card.no-image .goal-in-progress-indicator {
      box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.5);
    }

    .goal-empty-card.no-image .goal-in-progress-label {
      color: #10b981;
      text-shadow: none;
    }

    /* Full-Screen Celebration Overlay */
    .celebration-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.95);
      z-index: 10000;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }

    .celebration-overlay.active {
      opacity: 1;
      pointer-events: all;
    }

    .celebration-image {
      max-width: 600px;
      max-height: 600px;
      width: 80%;
      height: auto;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      margin-bottom: 40px;
      object-fit: cover;
    }

    .celebration-text {
      font-size: 3rem;
      font-weight: 200;
      color: #ffffff;
      text-align: center;
      margin-bottom: 20px;
      letter-spacing: -1px;
    }

    .celebration-subtext {
      font-size: 1.2rem;
      font-weight: 400;
      color: rgba(255, 255, 255, 0.7);
      text-align: center;
      max-width: 500px;
    }

    /* Goals in Background - Subtle mini version when tasks exist */
    @media (max-width: 768px) {
      .goals-empty-grid {
        grid-template-columns: repeat(3, 1fr);
      }
      
      .goal-empty-card:nth-child(1),
      .goal-empty-card:nth-child(2),
      .goal-empty-card:nth-child(3),
      .goal-empty-card:nth-child(4),
      .goal-empty-card:nth-child(5),
      .goal-empty-card:nth-child(6),
      .goal-empty-card:nth-child(7),
      .goal-empty-card:nth-child(8),
      .goal-empty-card:nth-child(n+9) {
        grid-column: span 1;
        grid-row: span 1;
      }
    }

    .goal-card {
      border-radius: 8px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      background: #f8f8f8;
      animation: gentleFloat 6s ease-in-out infinite;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
      min-height: 200px;
    }

    .goal-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.12);
    }

    .goal-card.has-image {
      background-size: cover;
      background-position: center;
      min-height: 280px;
    }

    .goal-card.no-image {
      min-height: 200px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 40px 30px;
      border: 2px dashed rgba(0, 0, 0, 0.1);
    }

    .goal-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(to top, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0.2) 50%, transparent 100%);
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 1;
    }

    .goal-card.has-image::before {
      opacity: 1;
    }

    /* Hover overlay - darkens image */
    .goal-card.has-image::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.2);
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 2;
    }

    .goal-card.has-image:hover::after {
      opacity: 1;
    }

    /* Checkbox - top right corner */
    .goal-checkbox {
      position: absolute;
      top: 12px;
      right: 12px;
      width: 20px;
      height: 20px;
      cursor: pointer;
      z-index: 10;
      accent-color: rgba(0, 0, 0, 0.8);
      opacity: 0.7;
      transition: all 0.2s;
    }

    .goal-checkbox:hover {
      opacity: 1;
      transform: scale(1.1);
    }

    .goal-card.has-image .goal-checkbox {
      accent-color: #ffffff;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
    }

    /* Progress bar at bottom */
    .goal-progress-bar {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background: rgba(0, 0, 0, 0.1);
      z-index: 3;
    }

    .goal-card.has-image .goal-progress-bar {
      background: rgba(255, 255, 255, 0.2);
    }

    .goal-progress-fill {
      height: 100%;
      background: #000000;
      transition: width 0.4s ease;
    }

    .goal-card.has-image .goal-progress-fill {
      background: #ffffff;
    }

    .goal-card-content {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 16px;
      z-index: 4;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .goal-card.no-image .goal-card-content {
      position: static;
      text-align: center;
      flex-direction: column;
      gap: 8px;
    }

    .goal-name {
      font-size: 0.85rem;
      font-weight: 500;
      letter-spacing: -0.2px;
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
      line-height: 1.3;
      flex: 1;
    }

    .goal-card.has-image .goal-name {
      color: #ffffff;
    }

    .goal-card.no-image .goal-name {
      color: #000000;
      text-shadow: none;
    }

    .goal-task-count {
      font-size: 0.7rem;
      color: rgba(255, 255, 255, 0.8);
      font-weight: 500;
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
      letter-spacing: 0.3px;
      margin-left: 8px;
    }

    .goal-card.no-image .goal-task-count {
      color: rgba(0, 0, 0, 0.5);
      text-shadow: none;
      margin-left: 0;
    }

    /* Hover action button */
    .goal-hover-action {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(255, 255, 255, 0.95);
      color: #000000;
      padding: 10px 20px;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 500;
      letter-spacing: 0.3px;
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s;
      z-index: 5;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .goal-card:hover .goal-hover-action {
      opacity: 1;
      pointer-events: all;
    }

    .goal-card.no-image .goal-hover-action {
      display: none;
    }

    /* Completed state */
    .goal-card.completed {
      opacity: 0.6;
    }

    .goal-card.completed.has-image {
      filter: grayscale(0.8);
    }

    .goal-card.completed::after {
      content: '‚úì';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 4rem;
      font-weight: 200;
      color: rgba(255, 255, 255, 0.95);
      z-index: 6;
      text-shadow: 0 0 20px rgba(255, 255, 255, 0.5);
      pointer-events: none;
    }

    .goal-card.completed.no-image::after {
      color: rgba(0, 0, 0, 0.3);
      text-shadow: none;
    }

    .goal-add-image-link {
      font-size: 0.7rem;
      color: rgba(0, 0, 0, 0.4);
      margin-top: 8px;
      display: inline-block;
      transition: all 0.2s;
    }

    .goal-add-image-link:hover {
      color: rgba(0, 0, 0, 0.7);
    }

    .goal-placeholder-icon {
      font-size: 2rem;
      margin-bottom: 12px;
      color: rgba(0, 0, 0, 0.2);
    }

    /* Anchor Cards */
    .anchor-card {
      border-radius: 8px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      background: #f8f8f8;
      border: 1px solid rgba(0, 0, 0, 0.08);
      padding: 25px;
      min-height: 160px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      animation: gentleFloat 6s ease-in-out infinite;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
      grid-column: span 1;
      grid-row: span 1;
    }

    .anchor-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.08);
      border-color: rgba(0, 0, 0, 0.15);
    }

    .anchor-name {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 10px;
      letter-spacing: -0.3px;
      color: #000000;
    }

    .anchor-status {
      font-size: 0.75rem;
      color: rgba(0, 0, 0, 0.5);
      font-weight: 400;
      letter-spacing: 0.3px;
    }

    @keyframes gentleFloat {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }

    /* WEEKLY PLAN - Two Column Layout */
    .planner-section {
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr 600px;
      gap: 60px;
      align-items: start;
    }

    .planner-section.empty-state {
      grid-template-columns: 1fr;
      max-width: 900px;
    }

    .tasks-column {
      min-height: 400px;
    }

    .goals-column {
      position: sticky;
      top: 20px;
    }

    .day-nav-btn {
      background: transparent;
      border: none;
      color: rgba(0, 0, 0, 0.3);
      padding: 4px 8px;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.3s;
      border-radius: 4px;
    }

    .day-nav-btn:hover {
      color: rgba(0, 0, 0, 0.7);
      background: rgba(0, 0, 0, 0.03);
    }

    .tasks-list {
      display: flex;
      flex-direction: column;
      gap: 1px;
      background: transparent;
      border-radius: 8px;
      overflow: visible;
      min-height: 200px;
    }

    .tasks-list.empty-state {
      display: none; /* Hidden when empty - grid takes full width */
    }

    .task-item {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 16px 20px;
      background: #ffffff;
      cursor: pointer;
      transition: all 0.2s;
    }

    .task-item:hover {
      background: #fafafa;
    }

    .task-item.dragging {
      opacity: 0.5;
    }

    /* Drag handle for sidebar tasks */
    .sidebar-task {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 12px;
      background: #fafafa;
      border: 1px solid rgba(0, 0, 0, 0.06);
      border-radius: 6px;
      cursor: move;
      transition: all 0.2s;
    }

    .sidebar-task:hover {
      background: #f5f5f5;
      border-color: rgba(0, 0, 0, 0.1);
    }

    .sidebar-task.dragging {
      opacity: 0.5;
    }

    .task-drag-handle {
      color: rgba(0, 0, 0, 0.3);
      font-size: 1rem;
      cursor: move;
      user-select: none;
    }

    /* Drop zone highlighting */
    .tasks-list.drag-over {
      background: rgba(0, 0, 0, 0.08);
      border: 2px dashed rgba(0, 0, 0, 0.2);
    }

    .empty-state.drag-over {
      background: rgba(0, 0, 0, 0.03);
      border: 2px dashed rgba(0, 0, 0, 0.2);
    }

    .task-checkbox {
      width: 18px;
      height: 18px;
      cursor: pointer;
      accent-color: #000000;
      flex-shrink: 0;
    }

    .task-content {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .task-name {
      font-size: 0.9rem;
      font-weight: 400;
      color: #000000;
      letter-spacing: -0.2px;
    }

    .task-item.completed .task-name {
      opacity: 0.4;
      text-decoration: line-through;
    }

    .task-goal-badge {
      width: 24px;
      height: 24px;
      border-radius: 4px;
      background-size: cover;
      background-position: center;
      border: 1px solid rgba(0, 0, 0, 0.1);
      flex-shrink: 0;
    }

    .add-task-btn {
      background: #ffffff;
      border: 1px dashed rgba(0, 0, 0, 0.15);
      color: rgba(0, 0, 0, 0.4);
      padding: 16px 20px;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.3s;
      border-radius: 8px;
      width: 100%;
      font-weight: 400;
      letter-spacing: 0.3px;
      display: none; /* Hidden - using inline input instead */
    }

    /* Inline Task Input - Document Editor Style */
    .inline-task-input {
      border: none;
      background: transparent;
      padding: 16px 20px;
      font-size: 0.9rem;
      color: rgba(0, 0, 0, 0.4);
      font-weight: 400;
      letter-spacing: -0.2px;
      width: 100%;
      outline: none;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      transition: all 0.2s;
    }

    .inline-task-input:focus {
      color: #000000;
      background: rgba(0, 0, 0, 0.01);
      border-radius: 8px;
    }

    .inline-task-input::placeholder {
      color: rgba(0, 0, 0, 0.3);
    }

    /* Task Goal Selector - Appears on focus */
    .task-goal-selector {
      display: none;
      padding: 8px 20px 16px;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .task-goal-selector.active {
      display: block;
      opacity: 1;
    }

    .task-goal-selector select {
      background: #fafafa;
      border: 1px solid rgba(0, 0, 0, 0.1);
      padding: 8px 12px;
      font-size: 0.8rem;
      color: rgba(0, 0, 0, 0.6);
      border-radius: 6px;
      cursor: pointer;
      outline: none;
      width: 200px;
      transition: all 0.2s;
    }

    .task-goal-selector select:focus {
      border-color: rgba(0, 0, 0, 0.2);
      background: #ffffff;
    }

    .task-goal-selector label {
      font-size: 0.7rem;
      color: rgba(0, 0, 0, 0.4);
      margin-right: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    /* Quick Action Icons */
    .quick-actions {
      display: flex;
      gap: 8px;
      align-items: center;
      margin-top: 12px;
      padding: 0 20px;
    }

    .quick-action-icon {
      width: 32px;
      height: 32px;
      border-radius: 6px;
      background: rgba(0, 0, 0, 0.04);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 1rem;
      position: relative;
    }

    .quick-action-icon:hover {
      background: rgba(0, 0, 0, 0.08);
      transform: scale(1.05);
    }

    .quick-action-icon:active {
      transform: scale(0.95);
    }

    .quick-action-tooltip {
      position: absolute;
      bottom: -28px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.9);
      color: #ffffff;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.65rem;
      white-space: nowrap;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.2s;
      z-index: 100;
    }

    .quick-action-icon:hover .quick-action-tooltip {
      opacity: 1;
    }

    /* Quick Action Dropdown */
    .quick-action-dropdown {
      position: absolute;
      top: 40px;
      left: 0;
      background: #ffffff;
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      padding: 8px 0;
      min-width: 200px;
      z-index: 1000;
      display: none;
    }

    .quick-action-dropdown.active {
      display: block;
    }

    .quick-action-dropdown-item {
      padding: 10px 16px;
      font-size: 0.85rem;
      color: rgba(0, 0, 0, 0.8);
      cursor: pointer;
      transition: all 0.2s;
    }

    .quick-action-dropdown-item:hover {
      background: rgba(0, 0, 0, 0.04);
      color: #000000;
    }

    .quick-action-dropdown-header {
      padding: 8px 16px;
      font-size: 0.7rem;
      color: rgba(0, 0, 0, 0.4);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      font-weight: 500;
    }

    .empty-state {
      min-height: 400px;
    }

    /* Right Sidebar - White Minimal */
    .sidebar {
      position: fixed;
      top: 0;
      right: -450px;
      width: 450px;
      height: 100vh;
      background: #ffffff;
      border-left: 1px solid rgba(0, 0, 0, 0.08);
      padding: 40px 30px;
      overflow-y: auto;
      transition: right 0.3s ease;
      z-index: 200;
      box-shadow: -10px 0 40px rgba(0, 0, 0, 0.08);
    }

    .sidebar.active {
      right: 0;
    }

    .sidebar-close {
      position: absolute;
      top: 20px;
      right: 20px;
      background: transparent;
      border: none;
      color: rgba(0, 0, 0, 0.4);
      font-size: 1.5rem;
      cursor: pointer;
      transition: all 0.2s;
      padding: 5px;
      line-height: 1;
    }

    .sidebar-close:hover {
      color: rgba(0, 0, 0, 0.8);
    }

    .sidebar-title {
      font-size: 1.3rem;
      font-weight: 500;
      margin-bottom: 25px;
      color: #000000;
      letter-spacing: -0.5px;
      padding-right: 30px;
    }

    .sidebar-section {
      margin-bottom: 30px;
    }

    .sidebar-label {
      font-size: 0.7rem;
      color: rgba(0, 0, 0, 0.5);
      margin-bottom: 10px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .sidebar-input, .sidebar-textarea, .sidebar-select {
      width: 100%;
      background: #fafafa;
      border: 1px solid rgba(0, 0, 0, 0.08);
      border-radius: 6px;
      padding: 12px 15px;
      color: #000000;
      font-size: 0.9rem;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica', 'Arial', sans-serif;
    }

    .sidebar-textarea {
      min-height: 100px;
      resize: vertical;
    }

    .sidebar-input:focus, .sidebar-textarea:focus, .sidebar-select:focus {
      outline: none;
      border-color: rgba(0, 0, 0, 0.2);
      background: #ffffff;
    }

    .sidebar-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 6px;
      margin-bottom: 20px;
    }

    .sidebar-tasks {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .sidebar-task {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 12px;
      background: #fafafa;
      border: 1px solid rgba(0, 0, 0, 0.06);
      border-radius: 6px;
    }

    .sidebar-task-checkbox {
      margin-top: 2px;
      width: 16px;
      height: 16px;
      cursor: pointer;
      accent-color: #000000;
      flex-shrink: 0;
    }

    .sidebar-task-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .sidebar-task-name {
      font-size: 0.85rem;
      color: #000000;
      line-height: 1.4;
    }

    .sidebar-task.completed .sidebar-task-name {
      opacity: 0.4;
      text-decoration: line-through;
    }

    .sidebar-task-schedule {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .schedule-btn {
      background: rgba(0, 0, 0, 0.05);
      border: 1px solid rgba(0, 0, 0, 0.1);
      color: rgba(0, 0, 0, 0.7);
      padding: 6px 12px;
      font-size: 0.75rem;
      cursor: pointer;
      border-radius: 4px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .schedule-btn:hover {
      background: rgba(0, 0, 0, 0.08);
      border-color: rgba(0, 0, 0, 0.2);
    }

    .schedule-dropdown {
      background: #fafafa;
      border: 1px solid rgba(0, 0, 0, 0.1);
      color: #000000;
      padding: 6px 10px;
      font-size: 0.75rem;
      border-radius: 4px;
      cursor: pointer;
    }

    .schedule-dropdown:focus {
      outline: none;
      border-color: rgba(0, 0, 0, 0.2);
    }

    .add-task-input {
      width: 100%;
      background: #fafafa;
      border: 1px solid rgba(0, 0, 0, 0.08);
      border-radius: 6px;
      padding: 12px 15px;
      color: #000000;
      font-size: 0.85rem;
      margin-top: 12px;
    }

    .add-task-input:focus {
      outline: none;
      border-color: rgba(0, 0, 0, 0.2);
    }

    .add-task-input::placeholder {
      color: rgba(0, 0, 0, 0.3);
    }

    .sidebar-progress {
      font-size: 1rem;
      color: #000000;
      font-weight: 500;
    }

    .delete-btn {
      background: rgba(255, 100, 100, 0.1);
      border: 1px solid rgba(255, 100, 100, 0.3);
      color: rgba(255, 50, 50, 0.9);
      padding: 12px 24px;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.3s;
      border-radius: 6px;
      width: 100%;
      font-weight: 500;
      margin-top: 20px;
    }

    .delete-btn:hover {
      background: rgba(255, 100, 100, 0.15);
      border-color: rgba(255, 100, 100, 0.5);
    }

    /* Action Buttons for Special Tasks */
    .action-btn {
      border: none;
      padding: 12px 20px;
      font-size: 0.85rem;
      cursor: pointer;
      border-radius: 6px;
      width: 100%;
      transition: all 0.2s;
      font-weight: 500;
    }

    .action-btn:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }

    .action-btn:active {
      transform: translateY(0);
    }

    /* Modal - White Minimal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(10px);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }

    .modal-overlay.active {
      opacity: 1;
      pointer-events: all;
    }

    .modal-content {
      background: #ffffff;
      border: 1px solid rgba(0, 0, 0, 0.08);
      border-radius: 12px;
      padding: 40px;
      max-width: 500px;
      width: 90%;
      max-height: 85vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
    }

    .modal-title {
      font-size: 1.3rem;
      font-weight: 500;
      margin-bottom: 25px;
      color: #000000;
      letter-spacing: -0.3px;
    }

    .modal-input, .modal-select {
      width: 100%;
      background: #fafafa;
      border: 1px solid rgba(0, 0, 0, 0.08);
      border-radius: 8px;
      padding: 14px 16px;
      color: #000000;
      font-size: 0.95rem;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica', 'Arial', sans-serif;
      margin-bottom: 20px;
    }

    .modal-input:focus, .modal-select:focus {
      outline: none;
      border-color: rgba(0, 0, 0, 0.2);
      background: #ffffff;
    }

    .modal-actions {
      display: flex;
      gap: 12px;
      margin-top: 25px;
    }

    .modal-btn {
      flex: 1;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 500;
      border: none;
      letter-spacing: 0.3px;
    }

    .modal-btn-cancel {
      background: #f5f5f5;
      color: rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(0, 0, 0, 0.08);
    }

    .modal-btn-cancel:hover {
      background: #eeeeee;
    }

    .modal-btn-primary {
      background: #000000;
      color: #ffffff;
    }

    .modal-btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .image-upload-area {
      border: 2px dashed rgba(0, 0, 0, 0.15);
      border-radius: 8px;
      padding: 40px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      background: #fafafa;
      margin-bottom: 20px;
    }

    .image-upload-area:hover {
      border-color: rgba(0, 0, 0, 0.3);
      background: #f5f5f5;
    }

    .image-upload-area.has-image {
      padding: 0;
      border: 1px solid rgba(0, 0, 0, 0.1);
    }

    .upload-preview {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 6px;
    }

    .upload-placeholder {
      color: rgba(0, 0, 0, 0.4);
      font-size: 0.9rem;
    }

    .upload-icon {
      font-size: 2rem;
      margin-bottom: 10px;
      color: rgba(0, 0, 0, 0.2);
    }

    .image-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }

    .image-grid-item {
      aspect-ratio: 1;
      border-radius: 6px;
      background-size: cover;
      background-position: center;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.3s;
    }

    .image-grid-item:hover {
      border-color: rgba(0, 0, 0, 0.3);
      transform: scale(1.05);
    }

    .image-grid-item.selected {
      border-color: #000000;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
    }

    /* Confetti */
    @keyframes confetti {
      0% { 
        transform: translateY(0) rotate(0deg);
        opacity: 1;
      }
      100% { 
        transform: translateY(-120px) rotate(360deg);
        opacity: 0;
      }
    }

    .confetti {
      position: fixed;
      width: 10px;
      height: 10px;
      background: #000000;
      animation: confetti 1s ease-out forwards;
      pointer-events: none;
      z-index: 9999;
      border-radius: 50%;
    }
  </style>
</head>

<body>
  
  <!-- Header -->
  <div class="dashboard-header">
    <button class="day-nav-btn" onclick="previousDay()">‚Üê</button>
    <div class="current-day-header" id="currentDayHeader">Monday</div>
    <button class="day-nav-btn" onclick="nextDay()">‚Üí</button>
    <a href="questionnaire.html" class="back-btn">‚Üê Back to Planner</a>
  </div>

  <!-- Main Container -->
  <div class="main-container">
    
    <!-- Weekly Planner - Two Column Layout -->
    <div class="planner-section" id="plannerSection">
      
      <!-- Left: Tasks Column (hidden when empty) -->
      <div class="tasks-column" id="tasksColumn">
        <div class="tasks-list" id="tasksList"></div>
        
        <!-- Inline Task Input -->
        <input 
          type="text" 
          class="inline-task-input" 
          id="inlineTaskInput"
          placeholder="+ Add task..."
          />
        
        <!-- Quick Action Icons -->
        <div class="quick-actions" id="quickActions">
          <div class="quick-action-icon" onclick="handleTherapy()">
            üí¨
            <div class="quick-action-tooltip">Therapy</div>
          </div>
          
          <div class="quick-action-icon" onclick="handleSunday()">
            üìÖ
            <div class="quick-action-tooltip">Sunday</div>
          </div>
          
          <div class="quick-action-icon" onclick="handleRest()">
            üò¥
            <div class="quick-action-tooltip">Rest</div>
          </div>
          
          <div class="quick-action-icon" onclick="toggleUplevel()" style="position: relative;">
            ‚¨ÜÔ∏è
            <div class="quick-action-tooltip">Uplevel</div>
            <div class="quick-action-dropdown" id="uplevelDropdown"></div>
          </div>
          
          <div class="quick-action-icon" onclick="toggleFun()" style="position: relative;">
            üéâ
            <div class="quick-action-tooltip">Fun</div>
            <div class="quick-action-dropdown" id="funDropdown"></div>
          </div>
        </div>
        
        <!-- Goal Selector (shows on focus) -->
        <div class="task-goal-selector" id="taskGoalSelector">
          <label>Link to goal:</label>
          <select id="inlineGoalSelect">
            <option value="">None</option>
          </select>
        </div>
      </div>

      <!-- Right: Goals Grid (always visible) -->
      <div class="goals-column" id="goalsColumn">
        <!-- Populated by JavaScript -->
      </div>

    </div>
    
    <!-- Empty State - Input First, Then Goals -->
    <div id="emptyStateContainer" style="display: none;">
      <!-- Inline Input for Empty State (at top) -->
      <div style="max-width: 800px; margin: 0 auto 60px;">
        <input 
          type="text" 
          class="inline-task-input" 
          id="emptyTaskInput"
          placeholder="+ Add task..."
          style="text-align: center; font-size: 1rem; padding: 20px;"
          />
        
        <!-- Quick Action Icons -->
        <div class="quick-actions" style="justify-content: center; padding: 0;">
          <div class="quick-action-icon" onclick="handleTherapy()">
            üí¨
            <div class="quick-action-tooltip">Therapy</div>
          </div>
          
          <div class="quick-action-icon" onclick="handleSunday()">
            üìÖ
            <div class="quick-action-tooltip">Sunday</div>
          </div>
          
          <div class="quick-action-icon" onclick="handleRest()">
            üò¥
            <div class="quick-action-tooltip">Rest</div>
          </div>
          
          <div class="quick-action-icon" onclick="toggleUplevel()" style="position: relative;">
            ‚¨ÜÔ∏è
            <div class="quick-action-tooltip">Uplevel</div>
            <div class="quick-action-dropdown" id="emptyUplevelDropdown"></div>
          </div>
          
          <div class="quick-action-icon" onclick="toggleFun()" style="position: relative;">
            üéâ
            <div class="quick-action-tooltip">Fun</div>
            <div class="quick-action-dropdown" id="emptyFunDropdown"></div>
          </div>
        </div>
        
        <!-- Goal Selector (shows on focus) -->
        <div class="task-goal-selector" id="emptyGoalSelector" style="text-align: center;">
          <label>Link to goal:</label>
          <select id="emptyGoalSelect">
            <option value="">None</option>
          </select>
        </div>
      </div>
      
      <!-- Goals Grid (larger, centered) -->
      <div id="emptyGoalsGrid" style="max-width: 1200px; margin: 0 auto;">
        <!-- Populated by JavaScript -->
      </div>
    </div>

  </div>

  <!-- Sidebar (for both tabs) -->
  <div class="sidebar" id="sidebar">
    <button class="sidebar-close" onclick="closeSidebar()">√ó</button>
    <div id="sidebarContent"></div>
  </div>

  <!-- Add Task Modal -->
  <div class="modal-overlay" id="addTaskModal">
    <div class="modal-content">
      <div class="modal-title">Add Task</div>
      <input type="text" id="taskNameInput" class="modal-input" placeholder="Task name" />
      <div style="margin-bottom: 10px; font-size: 0.85rem; color: rgba(255,255,255,0.5);">Tag a goal (optional):</div>
      <select id="taskGoalSelect" class="modal-select">
        <option value="">No goal</option>
      </select>
      <div class="modal-actions">
        <button class="modal-btn modal-btn-cancel" onclick="closeAddTaskModal()">Cancel</button>
        <button class="modal-btn modal-btn-primary" onclick="saveNewTask()">Add</button>
      </div>
    </div>
  </div>

  <!-- Goal Image Modal -->
  <div class="modal-overlay" id="goalImageModal">
    <div class="modal-content">
      <div class="modal-title">Add Image to Goal</div>
      
      <div class="image-upload-area" id="goalImageUploadArea" onclick="document.getElementById('goalImageInput').click()">
        <div id="goalUploadPlaceholder">
          <div class="upload-icon">+</div>
          <div class="upload-placeholder">Click to upload image</div>
        </div>
        <img id="goalImagePreview" class="upload-preview" style="display: none;" />
      </div>
      <input type="file" id="goalImageInput" accept="image/*" style="display: none;" onchange="handleGoalImageUpload(event)" />

      <div style="margin-bottom: 10px; font-size: 0.85rem; color: rgba(255,255,255,0.5);">Or choose from vision board:</div>
      <div class="image-grid" id="goalVisionGrid"></div>

      <div class="modal-actions">
        <button class="modal-btn modal-btn-cancel" onclick="closeGoalImageModal()">Cancel</button>
        <button class="modal-btn modal-btn-primary" onclick="saveGoalImage()">Save</button>
      </div>
    </div>
  </div>

  <!-- Full-Screen Celebration Overlay -->
  <div class="celebration-overlay" id="celebrationOverlay">
    <img class="celebration-image" id="celebrationImage" src="" alt="" />
    <div class="celebration-text" id="celebrationText">Goal Complete!</div>
    <div class="celebration-subtext" id="celebrationSubtext">Amazing work!</div>
  </div>

  <script>
    // Load questionnaire data
    const savedData = JSON.parse(localStorage.getItem('weeklyPlanData') || '{}');
    const questionnaireData = savedData.formData || savedData;
    
    // Load or initialize dashboard state
    let dashboardState = JSON.parse(localStorage.getItem('dashboardState') || 'null');

    // Vision board images
    const visionImages = [
      "badass.jpg", "b.jpg", "stick-to-your-plan.jpg", "powerfulenergy.jpg",
      "goddess.jpg", "gold-flow.jpg", "goodthings.jpg", "pexels-photo-15448063.webp", "spirit.jpg"
    ];

    // State
    let currentTab = 'goals';
    let currentDay = 'monday';
    let currentGoalForImage = null;
    let selectedGoalImage = null;

    function generateId() {
      return 'id_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    }

    function parseGoalsFromQuestionnaire(goalsText) {
      if (!goalsText) return [];
      
      if (Array.isArray(goalsText)) {
        return goalsText.map(g => ({
          id: generateId(),
          name: typeof g === 'string' ? g : g.name || 'Untitled Goal',
          image: (typeof g === 'object' && g.image) || null,
          description: '',
          tasks: []
        }));
      }
      
      return goalsText.split('\n')
        .filter(g => g.trim())
        .map(name => ({
          id: generateId(),
          name: name.trim(),
          image: null,
          description: '',
          tasks: []
        }));
    }

    // Initialize
    function initializeDashboard() {
      // Check if we need to migrate or reset
      const needsReset = dashboardState && (
        !dashboardState.goals || 
        !dashboardState.weeklyTasks || 
        dashboardState.weeklyBlocks // Old structure detected
      );
      
      if (!dashboardState || needsReset) {
        console.log('Initializing fresh dashboard state');
        dashboardState = {
          goals: [
            ...parseGoalsFromQuestionnaire(questionnaireData.workGoals),
            ...parseGoalsFromQuestionnaire(questionnaireData.lifeGoals)
          ],
          weeklyTasks: {
            monday: [],
            tuesday: [],
            wednesday: [],
            thursday: [],
            friday: [],
            saturday: [],
            sunday: []
          }
        };
        saveDashboard();
      }
      
      // Ensure all goals have tasks array
      if (dashboardState.goals) {
        dashboardState.goals = dashboardState.goals.map(goal => ({
          ...goal,
          tasks: goal.tasks || []
        }));
      }
      
      // Ensure weeklyTasks exists and has all days
      if (!dashboardState.weeklyTasks) {
        dashboardState.weeklyTasks = {
          monday: [],
          tuesday: [],
          wednesday: [],
          thursday: [],
          friday: [],
          saturday: [],
          sunday: []
        };
        saveDashboard();
      }

      console.log('Dashboard initialized:', dashboardState);
      renderTasks();
      initializeInlineTaskInput();
      initializeEmptyStateInput();
      initializeQuickActions();
    }

    // QUICK ACTIONS
    function initializeQuickActions() {
      // Load uplevel/fun options from localStorage (from questionnaire)
      const uplevelData = localStorage.getItem('uplevelingIdentity');
      const funData = localStorage.getItem('uplevelingLearning');
      
      // Populate dropdowns
      renderUplevelDropdown();
      renderFunDropdown();
      
      // Close dropdowns when clicking outside
      document.addEventListener('click', (e) => {
        if (!e.target.closest('.quick-action-icon')) {
          document.querySelectorAll('.quick-action-dropdown').forEach(d => d.classList.remove('active'));
        }
      });
    }

    function handleTherapy() {
      // Get breakthrough answers from questionnaire (localStorage)
      const breakthroughData = {
        wins: localStorage.getItem('breakthroughWins') || '',
        challenges: localStorage.getItem('breakthroughChallenges') || '',
        insights: localStorage.getItem('breakthroughInsights') || '',
        shifts: localStorage.getItem('breakthroughShifts') || '',
        integration: localStorage.getItem('breakthroughIntegration') || ''
      };
      
      // Build breakthrough text
      let breakthroughText = '**BREAKTHROUGHS FROM QUESTIONNAIRE:**\n\n';
      
      if (breakthroughData.wins) {
        breakthroughText += `**What were your biggest wins this week?**\n${breakthroughData.wins}\n\n`;
      }
      if (breakthroughData.challenges) {
        breakthroughText += `**What challenges pushed you to grow?**\n${breakthroughData.challenges}\n\n`;
      }
      if (breakthroughData.insights) {
        breakthroughText += `**What insights came through?**\n${breakthroughData.insights}\n\n`;
      }
      if (breakthroughData.shifts) {
        breakthroughText += `**What shifts are happening in your identity?**\n${breakthroughData.shifts}\n\n`;
      }
      if (breakthroughData.integration) {
        breakthroughText += `**How will you integrate these?**\n${breakthroughData.integration}\n\n`;
      }
      
      breakthroughText += '\n---\n\n**NEW BREAKTHROUGHS THIS WEEK:**\n(Add here - will auto-populate in next week\'s planner)\n\n';
      
      // Create therapy task
      const therapyTask = {
        id: generateId(),
        name: 'üí¨ Therapy Session',
        goalId: null,
        completed: false,
        description: breakthroughText,
        hasJournalingButton: true,
        breakthroughs: breakthroughData
      };
      
      if (!dashboardState.weeklyTasks[currentDay]) {
        dashboardState.weeklyTasks[currentDay] = [];
      }
      
      dashboardState.weeklyTasks[currentDay].push(therapyTask);
      saveDashboard();
      renderTasks();
    }

    function openJournaling(taskId) {
      const task = dashboardState.weeklyTasks[currentDay]?.find(t => t.id === taskId);
      if (!task || !task.breakthroughs) return;
      
      // Build ChatGPT prompt
      let prompt = 'Here are my breakthroughs this week:\n\n';
      
      if (task.breakthroughs.wins) {
        prompt += `Biggest wins: ${task.breakthroughs.wins}\n\n`;
      }
      if (task.breakthroughs.challenges) {
        prompt += `Growth challenges: ${task.breakthroughs.challenges}\n\n`;
      }
      if (task.breakthroughs.insights) {
        prompt += `Key insights: ${task.breakthroughs.insights}\n\n`;
      }
      if (task.breakthroughs.shifts) {
        prompt += `Identity shifts: ${task.breakthroughs.shifts}\n\n`;
      }
      if (task.breakthroughs.integration) {
        prompt += `Integration plan: ${task.breakthroughs.integration}\n\n`;
      }
      
      prompt += 'Help me process these breakthroughs and integrate them into my growth journey.';
      
      const chatGPTUrl = `https://chat.openai.com/?q=${encodeURIComponent(prompt)}`;
      window.open(chatGPTUrl, '_blank');
    }

    function handleSunday() {
      if (currentDay !== 'sunday') {
        alert('Navigate to Sunday to use this action');
        return;
      }
      
      // Auto-populate Sunday tasks with descriptions and buttons
      const sundayTasks = [
        {
          name: 'Weekly Finances',
          description: '',
          hasFinanceButton: true
        },
        {
          name: 'Hair Appointment',
          description: '',
          hasHairButton: true
        },
        {
          name: 'Grocery Shopping',
          description: ''
        }
      ];
      
      sundayTasks.forEach(taskData => {
        if (!dashboardState.weeklyTasks['sunday']) {
          dashboardState.weeklyTasks['sunday'] = [];
        }
        
        // Check if task already exists
        const exists = dashboardState.weeklyTasks['sunday'].some(t => t.name === taskData.name);
        if (!exists) {
          const newTask = {
            id: generateId(),
            name: taskData.name,
            goalId: null,
            completed: false,
            description: taskData.description,
            hasFinanceButton: taskData.hasFinanceButton || false,
            hasHairButton: taskData.hasHairButton || false
          };
          
          dashboardState.weeklyTasks['sunday'].push(newTask);
        }
      });
      
      saveDashboard();
      renderTasks();
    }

    function openFinanceSheet() {
      window.open('https://docs.google.com/spreadsheets/d/1fhXnyTk09IbDDvzs1cAceZUtBkYW5g90y_eICCVD9q0/edit?usp=sharing', '_blank');
    }

    function scheduleHairAppointment() {
      window.open('https://www.fresha.com/a/lush-bali-beauty-salon-umalas-bali-jl-tengah-no-8-kerobokan-badung-regency-jalan-tengah-no-8-jag4ep7n/booking?bookingId=1473368882&offerItems=sv%3A16699163&rebook=true&appointmentId=1092704254%3A1473368882&cartId=ea8710fa-fd62-4a34-a4a5-f986ed6c0620', '_blank');
    }

    function generateNextWeek() {
      // Open questionnaire in new tab for next week
      window.open('questionnaire.html', '_blank');
    }

    function handleRest() {
      // Create rest task with activity options
      const restTask = {
        id: generateId(),
        name: 'üò¥ Rest & Recharge',
        goalId: null,
        completed: false,
        description: '',
        hasRestOptions: true
      };
      
      if (!dashboardState.weeklyTasks[currentDay]) {
        dashboardState.weeklyTasks[currentDay] = [];
      }
      
      dashboardState.weeklyTasks[currentDay].push(restTask);
      saveDashboard();
      renderTasks();
    }

    function selectRestActivity(activity) {
      const links = {
        'massage': 'https://www.fresha.com',
        'movie': '',
        'cafe': '',
        'beach': ''
      };
      
      if (links[activity]) {
        window.open(links[activity], '_blank');
      }
      
      // Show confirmation
      const message = document.createElement('div');
      message.style.position = 'fixed';
      message.style.top = '50%';
      message.style.left = '50%';
      message.style.transform = 'translate(-50%, -50%)';
      message.style.background = 'rgba(0, 0, 0, 0.9)';
      message.style.color = '#ffffff';
      message.style.padding = '30px 50px';
      message.style.borderRadius = '12px';
      message.style.zIndex = '9999';
      message.style.fontSize = '1.2rem';
      message.style.fontWeight = '300';
      message.style.textAlign = 'center';
      message.style.pointerEvents = 'none';
      
      const activityNames = {
        'massage': 'üíÜ‚Äç‚ôÄÔ∏è Book Massage',
        'movie': 'üé¨ Movie & Order In',
        'cafe': '‚òï Nude Cafe Dinner',
        'beach': 'üåä Beach Walk'
      };
      
      message.textContent = `${activityNames[activity]} selected!`;
      
      document.body.appendChild(message);
      
      message.animate([
        { opacity: 0, transform: 'translate(-50%, -40%)' },
        { opacity: 1, transform: 'translate(-50%, -50%)', offset: 0.2 },
        { opacity: 1, transform: 'translate(-50%, -50%)', offset: 0.8 },
        { opacity: 0, transform: 'translate(-50%, -60%)' }
      ], {
        duration: 2000,
        easing: 'ease-out'
      });
      
      setTimeout(() => message.remove(), 2000);
    }

    function toggleUplevel() {
      const dropdown = document.getElementById('uplevelDropdown') || document.getElementById('emptyUplevelDropdown');
      const funDropdown = document.getElementById('funDropdown') || document.getElementById('emptyFunDropdown');
      
      if (funDropdown) funDropdown.classList.remove('active');
      
      if (dropdown) {
        dropdown.classList.toggle('active');
      }
    }

    function toggleFun() {
      const dropdown = document.getElementById('funDropdown') || document.getElementById('emptyFunDropdown');
      const uplevelDropdown = document.getElementById('uplevelDropdown') || document.getElementById('emptyUplevelDropdown');
      
      if (uplevelDropdown) uplevelDropdown.classList.remove('active');
      
      if (dropdown) {
        dropdown.classList.toggle('active');
      }
    }

    function renderUplevelDropdown() {
      const uplevelOptions = [
        "Badass builder (10 min)",
        "Flexibility (10 min)",
        "Dark feminine (10 min)",
        "$2.5k/mo biz (5 min)",
        "Social media fun (5 min)"
      ];
      
      const dropdowns = [
        document.getElementById('uplevelDropdown'),
        document.getElementById('emptyUplevelDropdown')
      ];
      
      dropdowns.forEach(dropdown => {
        if (!dropdown) return;
        
        let html = '<div class="quick-action-dropdown-header">Uplevel</div>';
        
        uplevelOptions.forEach(option => {
          html += `<div class="quick-action-dropdown-item" onclick="addQuickTask('${option}')">${option}</div>`;
        });
        
        dropdown.innerHTML = html;
      });
    }

    function renderFunDropdown() {
      const funOptions = [
        "Physics (10 min)",
        "Balinese (5 min)",
        "English vocab (5 min)"
      ];
      
      const dropdowns = [
        document.getElementById('funDropdown'),
        document.getElementById('emptyFunDropdown')
      ];
      
      dropdowns.forEach(dropdown => {
        if (!dropdown) return;
        
        let html = '<div class="quick-action-dropdown-header">Fun Learning</div>';
        
        funOptions.forEach(option => {
          html += `<div class="quick-action-dropdown-item" onclick="addQuickTask('${option}')">${option}</div>`;
        });
        
        dropdown.innerHTML = html;
      });
    }

    function addQuickTask(taskName) {
      const newTask = {
        id: generateId(),
        name: taskName,
        goalId: null,
        completed: false,
        description: ''
      };
      
      if (!dashboardState.weeklyTasks[currentDay]) {
        dashboardState.weeklyTasks[currentDay] = [];
      }
      
      dashboardState.weeklyTasks[currentDay].push(newTask);
      
      saveDashboard();
      renderTasks();
      
      // Close dropdown
      document.querySelectorAll('.quick-action-dropdown').forEach(d => d.classList.remove('active'));
    }

    // Inline Task Input - Tasks Column
    function initializeInlineTaskInput() {
      const input = document.getElementById('inlineTaskInput');
      const selector = document.getElementById('taskGoalSelector');
      const goalSelect = document.getElementById('inlineGoalSelect');
      
      if (!input) return;
      
      // Populate goal dropdown
      if (goalSelect && dashboardState.goals) {
        goalSelect.innerHTML = '<option value="">None</option>';
        dashboardState.goals.forEach(goal => {
          const option = document.createElement('option');
          option.value = goal.id;
          option.textContent = goal.name;
          goalSelect.appendChild(option);
        });
      }
      
      // Show goal selector on focus
      input.addEventListener('focus', () => {
        if (selector) {
          selector.classList.add('active');
        }
      });
      
      // Hide goal selector on blur (with delay for select click)
      input.addEventListener('blur', () => {
        setTimeout(() => {
          if (selector && document.activeElement !== goalSelect) {
            selector.classList.remove('active');
          }
        }, 200);
      });
      
      // Add task on Enter
      input.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          const taskName = input.value.trim();
          if (!taskName) return;
          
          const goalId = goalSelect ? goalSelect.value : null;
          
          addInlineTask(taskName, goalId);
          
          input.value = '';
          if (goalSelect) goalSelect.value = '';
          if (selector) selector.classList.remove('active');
          input.blur();
        }
      });
    }

    // Inline Task Input - Empty State
    function initializeEmptyStateInput() {
      const input = document.getElementById('emptyTaskInput');
      const selector = document.getElementById('emptyGoalSelector');
      const goalSelect = document.getElementById('emptyGoalSelect');
      
      if (!input) return;
      
      // Populate goal dropdown
      if (goalSelect && dashboardState.goals) {
        goalSelect.innerHTML = '<option value="">None</option>';
        dashboardState.goals.forEach(goal => {
          const option = document.createElement('option');
          option.value = goal.id;
          option.textContent = goal.name;
          goalSelect.appendChild(option);
        });
      }
      
      // Show goal selector on focus
      input.addEventListener('focus', () => {
        if (selector) {
          selector.classList.add('active');
        }
      });
      
      // Hide goal selector on blur (with delay for select click)
      input.addEventListener('blur', () => {
        setTimeout(() => {
          if (selector && document.activeElement !== goalSelect) {
            selector.classList.remove('active');
          }
        }, 200);
      });
      
      // Add task on Enter
      input.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          const taskName = input.value.trim();
          if (!taskName) return;
          
          const goalId = goalSelect ? goalSelect.value : null;
          
          addInlineTask(taskName, goalId);
          
          input.value = '';
          if (goalSelect) goalSelect.value = '';
          if (selector) selector.classList.remove('active');
          input.blur();
        }
      });
    }

    function addInlineTask(taskName, goalId) {
      const newTask = {
        id: generateId(),
        name: taskName,
        goalId: goalId || null,
        completed: false,
        description: ''
      };
      
      // Add to weekly tasks
      dashboardState.weeklyTasks[currentDay].push(newTask);
      
      // If linked to goal, add to goal's task list
      if (goalId) {
        const goal = dashboardState.goals.find(g => g.id === goalId);
        if (goal) {
          if (!goal.tasks) goal.tasks = [];
          
          const goalTask = {
            id: generateId(),
            name: taskName,
            completed: false,
            scheduledDay: currentDay
          };
          
          goal.tasks.push(goalTask);
          newTask.goalTaskIndex = goal.tasks.length - 1;
        }
      }
      
      saveDashboard();
      renderTasks();
    }

    function toggleGoalComplete(goalId) {
      const goal = dashboardState.goals.find(g => g.id === goalId);
      if (!goal) return;
      
      goal.completed = !goal.completed;
      saveDashboard();
      renderTasks(); // Re-render to update goals in empty state
      
      if (goal.completed) {
        showFullScreenCelebration(goal);
      }
    }

    function showFullScreenCelebration(goal) {
      const overlay = document.getElementById('celebrationOverlay');
      const image = document.getElementById('celebrationImage');
      const text = document.getElementById('celebrationText');
      const subtext = document.getElementById('celebrationSubtext');
      
      if (!overlay) return;
      
      // Set content
      text.textContent = 'Goal Complete!';
      subtext.textContent = `${goal.name} is complete! Amazing work! üéâ`;
      
      if (goal.image) {
        image.src = goal.image;
        image.style.display = 'block';
      } else {
        image.style.display = 'none';
      }
      
      // Show overlay
      overlay.classList.add('active');
      
      // Full-screen confetti explosion
      createFullScreenConfetti();
      
      // Hide after 3 seconds
      setTimeout(() => {
        overlay.classList.remove('active');
      }, 3000);
    }

    function createFullScreenConfetti() {
      const colors = ['#10b981', '#3b82f6', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899', '#14b8a6', '#f97316'];
      
      // Create 100 confetti particles across entire screen
      for (let i = 0; i < 100; i++) {
        const confetti = document.createElement('div');
        confetti.style.position = 'fixed';
        confetti.style.left = Math.random() * window.innerWidth + 'px';
        confetti.style.top = Math.random() * window.innerHeight + 'px';
        confetti.style.width = (Math.random() * 12 + 6) + 'px';
        confetti.style.height = (Math.random() * 12 + 6) + 'px';
        confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
        confetti.style.pointerEvents = 'none';
        confetti.style.zIndex = '10001';
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        
        document.body.appendChild(confetti);

        const tx = (Math.random() - 0.5) * 600;
        const ty = (Math.random() - 0.5) * 600;
        const rotation = Math.random() * 720 - 360;

        confetti.animate([
          { 
            transform: 'translate(0, 0) rotate(0deg) scale(1)',
            opacity: 1
          },
          { 
            transform: `translate(${tx}px, ${ty}px) rotate(${rotation}deg) scale(0)`,
            opacity: 0
          }
        ], {
          duration: 1200 + Math.random() * 800,
          easing: 'cubic-bezier(0, .9, .57, 1)',
        });

        setTimeout(() => confetti.remove(), 2000);
      }
    }

    function showEnhancedConfetti(element) {
      const rect = element.getBoundingClientRect();
      const x = rect.left + rect.width / 2;
      const y = rect.top + rect.height / 2;

      // Create 40 particles (was 20)
      for (let i = 0; i < 40; i++) {
        const confetti = document.createElement('div');
        confetti.style.position = 'fixed';
        confetti.style.left = x + 'px';
        confetti.style.top = y + 'px';
        confetti.style.width = '8px';
        confetti.style.height = '8px';
        confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
        confetti.style.pointerEvents = 'none';
        confetti.style.zIndex = '10000';
        
        // Vibrant colors
        const colors = ['#10b981', '#3b82f6', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899'];
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        
        document.body.appendChild(confetti);

        const angle = (Math.PI * 2 * i) / 40;
        const velocity = 100 + Math.random() * 100;
        const tx = Math.cos(angle) * velocity;
        const ty = Math.sin(angle) * velocity;

        confetti.animate([
          { 
            transform: 'translate(0, 0) rotate(0deg) scale(1)',
            opacity: 1
          },
          { 
            transform: `translate(${tx}px, ${ty}px) rotate(${Math.random() * 360}deg) scale(0)`,
            opacity: 0
          }
        ], {
          duration: 800 + Math.random() * 400,
          easing: 'cubic-bezier(0, .9, .57, 1)',
        });

        setTimeout(() => confetti.remove(), 1200);
      }
      
      // Add a checkmark burst
      const checkmark = document.createElement('div');
      checkmark.textContent = '‚úì';
      checkmark.style.position = 'fixed';
      checkmark.style.left = x + 'px';
      checkmark.style.top = y + 'px';
      checkmark.style.fontSize = '60px';
      checkmark.style.fontWeight = '200';
      checkmark.style.color = '#10b981';
      checkmark.style.pointerEvents = 'none';
      checkmark.style.zIndex = '10001';
      checkmark.style.textShadow = '0 0 20px rgba(16, 185, 129, 0.8)';
      document.body.appendChild(checkmark);
      
      checkmark.animate([
        { 
          transform: 'translate(-50%, -50%) scale(0) rotate(-180deg)',
          opacity: 0
        },
        { 
          transform: 'translate(-50%, -50%) scale(1.5) rotate(0deg)',
          opacity: 1,
          offset: 0.5
        },
        { 
          transform: 'translate(-50%, -50%) scale(1) rotate(0deg)',
          opacity: 0
        }
      ], {
        duration: 1000,
        easing: 'cubic-bezier(0.68, -0.55, 0.265, 1.55)',
      });
      
      setTimeout(() => checkmark.remove(), 1000);
    }

    // GOALS TAB
    function renderGoals() {
      const grid = document.getElementById('goalsGrid');
      if (!grid) return;
      
      grid.innerHTML = '';
      
      // Ensure goals array exists
      if (!dashboardState.goals) {
        dashboardState.goals = [
          ...parseGoalsFromQuestionnaire(questionnaireData.workGoals),
          ...parseGoalsFromQuestionnaire(questionnaireData.lifeGoals)
        ];
        saveDashboard();
      }
      
      // Render goal cards
      dashboardState.goals.forEach(goal => {
        const card = document.createElement('div');
        card.className = 'goal-card';
        
        const completedTasks = goal.tasks ? goal.tasks.filter(t => t.completed).length : 0;
        const totalTasks = goal.tasks ? goal.tasks.length : 0;
        const progress = totalTasks > 0 ? `${completedTasks}/${totalTasks} complete` : 'No tasks yet';
        
        if (goal.image) {
          card.classList.add('has-image');
          card.style.backgroundImage = `url('${goal.image}')`;
          card.innerHTML = `
            <div class="goal-card-content">
              <div class="goal-name">${goal.name}</div>
              <div class="goal-progress">${progress}</div>
            </div>
          `;
        } else {
          card.classList.add('no-image');
          card.innerHTML = `
            <div class="goal-card-content">
              <div class="goal-placeholder-icon">+</div>
              <div class="goal-name">${goal.name}</div>
              <div class="goal-progress">${progress}</div>
              <div class="goal-add-image-link" onclick="event.stopPropagation(); showGoalImageModal('${goal.id}')">Add image</div>
            </div>
          `;
        }
        
        card.onclick = (e) => {
          if (!e.target.classList.contains('goal-add-image-link')) {
            openGoalSidebar(goal.id);
          }
        };
        
        grid.appendChild(card);
      });
      
      // Render anchor cards
      if (dashboardState.anchors) {
        dashboardState.anchors.forEach(anchor => {
          const card = document.createElement('div');
          card.className = 'anchor-card';
          
          let status = '';
          if (anchor.name.includes('Workout')) {
            status = `${anchor.count}/${anchor.target} workouts`;
          } else if (anchor.name.includes('Expenses')) {
            status = `$${anchor.amount}/$${anchor.target}`;
          }
          
          card.innerHTML = `
            <div class="anchor-name">${anchor.name}</div>
            <div class="anchor-status">${status}</div>
          `;
          
          card.onclick = () => openAnchorSidebar(anchor.id);
          
          grid.appendChild(card);
        });
      }
    }

    function openGoalSidebar(goalId) {
      const goal = dashboardState.goals.find(g => g.id === goalId);
      if (!goal) return;
      
      const completedTasks = goal.tasks ? goal.tasks.filter(t => t.completed).length : 0;
      const totalTasks = goal.tasks ? goal.tasks.length : 0;
      
      let html = `
        <div class="sidebar-title">${goal.name}</div>
        
        ${goal.image ? `
          <img src="${goal.image}" class="sidebar-image" onclick="showGoalImageModal('${goalId}')" style="cursor: pointer;" />
        ` : `
          <button class="add-task-input" onclick="showGoalImageModal('${goalId}')" style="text-align: center; cursor: pointer; margin-bottom: 20px;">+ Add Image</button>
        `}
        
        <div class="sidebar-section">
          <div class="sidebar-label">Description</div>
          <textarea class="sidebar-textarea" id="goalDescription" placeholder="Add description...">${goal.description || ''}</textarea>
        </div>
        
        <div class="sidebar-section">
          <div class="sidebar-label">Progress</div>
          <div class="sidebar-progress">${completedTasks}/${totalTasks} tasks complete</div>
        </div>
        
        <div class="sidebar-section">
          <div class="sidebar-label">Tasks</div>
          <div class="sidebar-tasks" id="goalTasks"></div>
          <input type="text" class="add-task-input" id="newGoalTaskInput" placeholder="+ Add task..." onkeypress="handleAddGoalTask(event, '${goalId}')" />
        </div>
        
        <button class="delete-btn" onclick="deleteGoal('${goalId}')">Delete Goal</button>
      `;
      
      document.getElementById('sidebarContent').innerHTML = html;
      
      // Render tasks
      renderGoalTasks(goal);
      
      // Save description on blur
      document.getElementById('goalDescription').onblur = () => {
        goal.description = document.getElementById('goalDescription').value;
        saveDashboard();
      };
      
      document.getElementById('sidebar').classList.add('active');
    }

    function renderGoalTasks(goal) {
      const container = document.getElementById('goalTasks');
      if (!container) return;
      
      container.innerHTML = '';
      
      if (!goal.tasks || goal.tasks.length === 0) {
        return;
      }
      
      goal.tasks.forEach((task, index) => {
        const taskEl = document.createElement('div');
        taskEl.className = 'sidebar-task' + (task.completed ? ' completed' : '');
        taskEl.draggable = true;
        taskEl.dataset.goalId = goal.id;
        taskEl.dataset.taskIndex = index;
        
        // Drag event handlers
        taskEl.addEventListener('dragstart', handleTaskDragStart);
        taskEl.addEventListener('dragend', handleTaskDragEnd);
        
        const scheduledDay = task.scheduledDay || 'none';
        const scheduledText = scheduledDay !== 'none' ? capitalizeDay(scheduledDay) : '';
        
        taskEl.innerHTML = `
          <div class="task-drag-handle">‚ãÆ‚ãÆ</div>
          <input type="checkbox" class="sidebar-task-checkbox" ${task.completed ? 'checked' : ''} 
                 onchange="toggleGoalTask('${goal.id}', ${index})" />
          <div class="sidebar-task-content">
            <div class="sidebar-task-name">${task.name}</div>
            ${scheduledText ? `<div style="font-size: 0.7rem; color: rgba(0, 0, 0, 0.4); margin-top: 4px;">‚Üí ${scheduledText}</div>` : ''}
          </div>
        `;
        
        container.appendChild(taskEl);
      });
    }

    function capitalizeDay(day) {
      return day.charAt(0).toUpperCase() + day.slice(1);
    }

    // Drag and Drop Handlers
    let draggedTaskData = null;

    function handleTaskDragStart(e) {
      const taskEl = e.currentTarget;
      taskEl.classList.add('dragging');
      
      const goalId = taskEl.dataset.goalId;
      const taskIndex = parseInt(taskEl.dataset.taskIndex);
      
      draggedTaskData = { goalId, taskIndex };
      
      e.dataTransfer.effectAllowed = 'move';
      e.dataTransfer.setData('text/html', taskEl.innerHTML);
    }

    function handleTaskDragEnd(e) {
      e.currentTarget.classList.remove('dragging');
    }

    // Initialize drop zone on tasks list
    function initializeDropZone() {
      const tasksList = document.getElementById('tasksList');
      if (!tasksList) return;
      
      tasksList.addEventListener('dragover', handleDragOver);
      tasksList.addEventListener('dragleave', handleDragLeave);
      tasksList.addEventListener('drop', handleDrop);
    }

    function handleDragOver(e) {
      e.preventDefault();
      e.dataTransfer.dropEffect = 'move';
      
      const tasksList = e.currentTarget;
      tasksList.classList.add('drag-over');
      
      // Also add to empty state if present
      const emptyState = tasksList.querySelector('.empty-state');
      if (emptyState) {
        emptyState.classList.add('drag-over');
      }
    }

    function handleDragLeave(e) {
      const tasksList = e.currentTarget;
      
      // Only remove if we're actually leaving the tasksList, not a child
      if (!tasksList.contains(e.relatedTarget)) {
        tasksList.classList.remove('drag-over');
        
        const emptyState = tasksList.querySelector('.empty-state');
        if (emptyState) {
          emptyState.classList.remove('drag-over');
        }
      }
    }

    function handleDrop(e) {
      e.preventDefault();
      
      const tasksList = e.currentTarget;
      tasksList.classList.remove('drag-over');
      
      const emptyState = tasksList.querySelector('.empty-state');
      if (emptyState) {
        emptyState.classList.remove('drag-over');
      }
      
      if (!draggedTaskData) return;
      
      const { goalId, taskIndex } = draggedTaskData;
      const goal = dashboardState.goals.find(g => g.id === goalId);
      if (!goal || !goal.tasks[taskIndex]) return;
      
      const task = goal.tasks[taskIndex];
      
      // Update the task's scheduled day
      task.scheduledDay = currentDay;
      
      // Create task in weekly planner
      const weeklyTask = {
        id: generateId(),
        name: task.name,
        goalId: goalId,
        goalTaskIndex: taskIndex,
        completed: task.completed || false,
        description: ''
      };
      
      if (!dashboardState.weeklyTasks[currentDay]) {
        dashboardState.weeklyTasks[currentDay] = [];
      }
      
      dashboardState.weeklyTasks[currentDay].push(weeklyTask);
      
      saveDashboard();
      renderTasks();
      renderMiniGoalCubes();
      
      // Update sidebar if it's open for this goal
      if (document.getElementById('sidebar').classList.contains('active')) {
        renderGoalTasks(goal);
      }
      
      draggedTaskData = null;
    }

    function handleAddGoalTask(e, goalId) {
      if (e.key !== 'Enter') return;
      
      const input = document.getElementById('newGoalTaskInput');
      const taskName = input.value.trim();
      if (!taskName) return;
      
      const goal = dashboardState.goals.find(g => g.id === goalId);
      if (!goal) return;
      
      if (!goal.tasks) {
        goal.tasks = [];
      }
      
      goal.tasks.push({
        id: generateId(),
        name: taskName,
        completed: false,
        scheduledDay: 'none'
      });
      
      saveDashboard();
      renderGoalTasks(goal);
      renderTasks(); // Update empty state if showing goals
      input.value = '';
    }

    function toggleGoalTask(goalId, taskIndex) {
      const goal = dashboardState.goals.find(g => g.id === goalId);
      if (!goal || !goal.tasks[taskIndex]) return;
      
      goal.tasks[taskIndex].completed = !goal.tasks[taskIndex].completed;
      
      if (goal.tasks[taskIndex].completed) {
        showConfetti(event.target);
      }
      
      // Also update in weekly tasks if scheduled
      const task = goal.tasks[taskIndex];
      if (task.scheduledDay && task.scheduledDay !== 'none') {
        const weeklyTask = dashboardState.weeklyTasks[task.scheduledDay].find(t => t.goalTaskId === task.id);
        if (weeklyTask) {
          weeklyTask.completed = task.completed;
        }
      }
      
      saveDashboard();
      renderGoalTasks(goal);
      renderGoals();
      renderTasks();
    }

    function scheduleGoalTask(goalId, taskIndex, day) {
      const goal = dashboardState.goals.find(g => g.id === goalId);
      if (!goal || !goal.tasks[taskIndex]) return;
      
      const task = goal.tasks[taskIndex];
      const oldDay = task.scheduledDay;
      
      // Remove from old day
      if (oldDay && oldDay !== 'none') {
        dashboardState.weeklyTasks[oldDay] = dashboardState.weeklyTasks[oldDay].filter(t => t.goalTaskId !== task.id);
      }
      
      // Update task
      task.scheduledDay = day;
      
      // Add to new day
      if (day !== 'none') {
        dashboardState.weeklyTasks[day].push({
          id: generateId(),
          name: task.name,
          goalId: goalId,
          goalTaskId: task.id,
          completed: task.completed,
          description: ''
        });
      }
      
      saveDashboard();
      renderGoalTasks(goal);
      renderTasks();
    }

    function deleteGoal(goalId) {
      if (!confirm('Delete this goal and all its tasks?')) return;
      
      dashboardState.goals = dashboardState.goals.filter(g => g.id !== goalId);
      
      // Remove from weekly tasks
      Object.keys(dashboardState.weeklyTasks).forEach(day => {
        dashboardState.weeklyTasks[day] = dashboardState.weeklyTasks[day].filter(t => t.goalId !== goalId);
      });
      
      saveDashboard();
      renderGoals();
      closeSidebar();
    }

    function openAnchorSidebar(anchorId) {
      const anchor = dashboardState.anchors.find(a => a.id === anchorId);
      if (!anchor) return;
      
      let html = '';
      
      if (anchor.name.includes('Workout')) {
        html = `
          <div class="sidebar-title">${anchor.name}</div>
          <div class="sidebar-section">
            <div class="sidebar-label">Current Progress</div>
            <div class="sidebar-progress">${anchor.count}/${anchor.target} workouts</div>
            <button class="schedule-btn" onclick="incrementAnchor('${anchorId}')" style="margin-top: 15px; width: 100%;">+ Log Workout</button>
          </div>
        `;
      } else {
        html = `
          <div class="sidebar-title">${anchor.name}</div>
          <div class="sidebar-section">
            <div class="sidebar-label">Current Spending</div>
            <div class="sidebar-progress">$${anchor.amount}/$${anchor.target}</div>
            <input type="number" class="sidebar-input" id="expenseAmount" placeholder="Enter amount" style="margin-top: 15px;" />
            <button class="schedule-btn" onclick="addExpense('${anchorId}')" style="margin-top: 10px; width: 100%;">Add Expense</button>
          </div>
        `;
      }
      
      document.getElementById('sidebarContent').innerHTML = html;
      document.getElementById('sidebar').classList.add('active');
    }

    function incrementAnchor(anchorId) {
      const anchor = dashboardState.anchors.find(a => a.id === anchorId);
      if (!anchor) return;
      
      anchor.count++;
      saveDashboard();
      renderGoals();
      openAnchorSidebar(anchorId);
    }

    function addExpense(anchorId) {
      const anchor = dashboardState.anchors.find(a => a.id === anchorId);
      const input = document.getElementById('expenseAmount');
      const amount = parseFloat(input.value);
      
      if (!anchor || !amount || amount <= 0) return;
      
      anchor.amount += amount;
      saveDashboard();
      renderGoals();
      openAnchorSidebar(anchorId);
    }

    // WEEKLY PLAN
    function renderTasks() {
      const tasksList = document.getElementById('tasksList');
      const tasksColumn = document.getElementById('tasksColumn');
      const goalsColumn = document.getElementById('goalsColumn');
      const plannerSection = document.getElementById('plannerSection');
      const emptyStateContainer = document.getElementById('emptyStateContainer');
      const emptyGoalsGrid = document.getElementById('emptyGoalsGrid');
      
      if (!tasksList || !goalsColumn) {
        console.error('Required containers not found');
        return;
      }
      
      tasksList.innerHTML = '';
      
      console.log('Rendering tasks for:', currentDay);
      const tasks = dashboardState.weeklyTasks[currentDay] || [];
      console.log('Tasks for', currentDay, ':', tasks);
      
      // EMPTY STATE: Hide planner, show empty state container with large grid
      if (tasks.length === 0) {
        tasksList.classList.add('empty-state');
        tasksColumn.style.display = 'none';
        plannerSection.style.display = 'none';
        if (emptyStateContainer) emptyStateContainer.style.display = 'block';
        if (emptyGoalsGrid) emptyGoalsGrid.innerHTML = renderGoalsGrid(true); // true = large
        
        updateDayLabel();
        return;
      }
      
      // HAS TASKS: Show planner, hide empty state, two-column layout
      tasksList.classList.remove('empty-state');
      tasksColumn.style.display = 'block';
      plannerSection.style.display = 'grid';
      plannerSection.classList.remove('empty-state');
      if (emptyStateContainer) emptyStateContainer.style.display = 'none';
      
      // Render goals in right column
      goalsColumn.innerHTML = renderGoalsGrid(false); // false = normal size
      
      tasks.forEach(task => {
        const taskEl = document.createElement('div');
        taskEl.className = 'task-item' + (task.completed ? ' completed' : '');
        taskEl.draggable = false;
        
        const goal = dashboardState.goals ? dashboardState.goals.find(g => g.id === task.goalId) : null;
        
        taskEl.innerHTML = `
          <input type="checkbox" class="task-checkbox" ${task.completed ? 'checked' : ''} 
                 onchange="toggleWeeklyTask('${task.id}')" />
          <div class="task-content">
            ${goal && goal.image ? `<div class="task-goal-badge" style="background-image: url('${goal.image}')"></div>` : ''}
            <div class="task-name">${task.name}</div>
          </div>
        `;
        
        taskEl.onclick = (e) => {
          if (e.target.type !== 'checkbox') {
            openTaskSidebar(task.id);
          }
        };
        
        tasksList.appendChild(taskEl);
      });
      
      // Add "Plan for Next Week" button on Sunday
      if (currentDay === 'sunday') {
        const planButton = document.createElement('button');
        planButton.className = 'action-btn';
        planButton.style.background = '#8b5cf6';
        planButton.style.color = '#ffffff';
        planButton.style.marginTop = '20px';
        planButton.textContent = 'üìã Plan for Next Week';
        planButton.onclick = generateNextWeek;
        tasksList.appendChild(planButton);
      }
      
      updateDayLabel();
    }

    function renderGoalsGrid(isLarge = false) {
      if (!dashboardState.goals || dashboardState.goals.length === 0) {
        console.log('No goals to render');
        return '<div style="text-align: center; padding: 40px; color: rgba(0,0,0,0.3); font-size: 0.85rem;">No goals yet</div>';
      }
      
      console.log('Rendering goals grid:', dashboardState.goals);
      
      const gridClass = isLarge ? 'goals-empty-grid-large' : 'goals-empty-grid';
      let html = `<div class="${gridClass}">`;
      
      dashboardState.goals.forEach(goal => {
        console.log('Goal:', goal.name, 'Image:', goal.image);
        const isComplete = goal.completed || false;
        const completedClass = isComplete ? ' completed' : '';
        const hasActiveTasks = goal.tasks && goal.tasks.length > 0 && !isComplete;
        
        if (goal.image) {
          html += `
            <div class="goal-empty-card has-image${completedClass}" style="background-image: url('${goal.image}')" 
                 onclick="openGoalSidebar('${goal.id}')">
              <input type="checkbox" class="goal-empty-checkbox" ${isComplete ? 'checked' : ''} 
                     onclick="event.stopPropagation(); toggleGoalComplete('${goal.id}')" />
              ${hasActiveTasks ? '<div class="goal-in-progress-indicator"></div><div class="goal-in-progress-label">In Progress</div>' : ''}
              <div class="goal-empty-content">
                <div class="goal-empty-name">${goal.name}</div>
              </div>
            </div>
          `;
        } else {
          html += `
            <div class="goal-empty-card no-image${completedClass}" onclick="openGoalSidebar('${goal.id}')">
              <input type="checkbox" class="goal-empty-checkbox" ${isComplete ? 'checked' : ''} 
                     onclick="event.stopPropagation(); toggleGoalComplete('${goal.id}')" />
              ${hasActiveTasks ? '<div class="goal-in-progress-indicator"></div><div class="goal-in-progress-label">In Progress</div>' : ''}
              <div class="goal-empty-content">
                <div class="goal-empty-placeholder-icon">+</div>
                <div class="goal-empty-name">${goal.name}</div>
                <div class="goal-empty-add-image" onclick="event.stopPropagation(); showGoalImageModal('${goal.id}')">Add image</div>
              </div>
            </div>
          `;
        }
      });
      
      html += '</div>';
      
      return html;
    }

    function updateDayLabel() {
      const dayNames = {
        monday: 'Monday',
        tuesday: 'Tuesday',
        wednesday: 'Wednesday',
        thursday: 'Thursday',
        friday: 'Friday',
        saturday: 'Saturday',
        sunday: 'Sunday'
      };
      
      const headerDay = document.getElementById('currentDayHeader');
      if (headerDay) {
        const dayName = dayNames[currentDay] || 'Monday';
        const dateRange = getWeekDateRange();
        headerDay.innerHTML = `
          <div class="day-name">${dayName}</div>
          <div class="date-range">${dateRange}</div>
        `;
      }
    }

    function getWeekDateRange() {
      const today = new Date();
      const dayOfWeek = today.getDay();
      const diff = dayOfWeek === 0 ? -6 : 1 - dayOfWeek; // Monday is start
      
      const monday = new Date(today);
      monday.setDate(today.getDate() + diff);
      
      const sunday = new Date(monday);
      sunday.setDate(monday.getDate() + 6);
      
      const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      
      const startMonth = monthNames[monday.getMonth()];
      const endMonth = monthNames[sunday.getMonth()];
      const startDay = monday.getDate();
      const endDay = sunday.getDate();
      
      if (startMonth === endMonth) {
        return `${startMonth} ${startDay}-${endDay}`.toUpperCase();
      } else {
        return `${startMonth} ${startDay}-${endMonth} ${endDay}`.toUpperCase();
      }
    }

    function previousDay() {
      const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
      const currentIndex = days.indexOf(currentDay);
      currentDay = days[(currentIndex - 1 + 7) % 7];
      console.log('Previous day:', currentDay);
      renderTasks();
    }

    function nextDay() {
      const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
      const currentIndex = days.indexOf(currentDay);
      currentDay = days[(currentIndex + 1) % 7];
      console.log('Next day:', currentDay);
      renderTasks();
    }

    function toggleWeeklyTask(taskId) {
      const task = dashboardState.weeklyTasks[currentDay].find(t => t.id === taskId);
      if (!task) return;
      
      task.completed = !task.completed;
      
      // Update goal task if linked
      if (task.goalTaskId) {
        const goal = dashboardState.goals.find(g => g.id === task.goalId);
        if (goal) {
          const goalTask = goal.tasks.find(t => t.id === task.goalTaskId);
          if (goalTask) {
            goalTask.completed = task.completed;
          }
        }
      }
      
      if (task.completed) {
        showTaskCompleteCelebration(task, event.target);
      }
      
      saveDashboard();
      renderTasks();
    }

    function showTaskCompleteCelebration(task, element) {
      // Check if linked to goal
      const goal = task.goalId ? dashboardState.goals.find(g => g.id === task.goalId) : null;
      
      // Create encouraging message overlay
      const message = document.createElement('div');
      message.style.position = 'fixed';
      message.style.top = '50%';
      message.style.left = '50%';
      message.style.transform = 'translate(-50%, -50%)';
      message.style.background = 'rgba(0, 0, 0, 0.9)';
      message.style.color = '#ffffff';
      message.style.padding = '30px 50px';
      message.style.borderRadius = '12px';
      message.style.zIndex = '9999';
      message.style.fontSize = '1.5rem';
      message.style.fontWeight = '300';
      message.style.textAlign = 'center';
      message.style.pointerEvents = 'none';
      
      if (goal && !goal.completed) {
        const completedTasks = goal.tasks ? goal.tasks.filter(t => t.completed).length : 0;
        const totalTasks = goal.tasks ? goal.tasks.length : 0;
        message.innerHTML = `‚ú® You're so close!<br/><span style="font-size: 1rem; opacity: 0.7;">${completedTasks}/${totalTasks} tasks complete</span>`;
      } else {
        const messages = [
          '‚ú® Amazing!',
          'üéØ You did it!',
          'üí™ Keep going!',
          'üî• On fire!',
          '‚≠ê Fantastic!'
        ];
        message.textContent = messages[Math.floor(Math.random() * messages.length)];
      }
      
      document.body.appendChild(message);
      
      // Animate in
      message.animate([
        { opacity: 0, transform: 'translate(-50%, -40%)' },
        { opacity: 1, transform: 'translate(-50%, -50%)', offset: 0.3 },
        { opacity: 1, transform: 'translate(-50%, -50%)', offset: 0.7 },
        { opacity: 0, transform: 'translate(-50%, -60%)' }
      ], {
        duration: 2000,
        easing: 'ease-out'
      });
      
      // Small confetti burst
      createSmallConfetti(element);
      
      setTimeout(() => message.remove(), 2000);
    }

    function createSmallConfetti(element) {
      const rect = element.getBoundingClientRect();
      const x = rect.left + rect.width / 2;
      const y = rect.top + rect.height / 2;
      
      const colors = ['#10b981', '#3b82f6', '#f59e0b', '#ec4899'];
      
      for (let i = 0; i < 20; i++) {
        const confetti = document.createElement('div');
        confetti.style.position = 'fixed';
        confetti.style.left = x + 'px';
        confetti.style.top = y + 'px';
        confetti.style.width = '6px';
        confetti.style.height = '6px';
        confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
        confetti.style.pointerEvents = 'none';
        confetti.style.zIndex = '9998';
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        
        document.body.appendChild(confetti);

        const angle = (Math.PI * 2 * i) / 20;
        const velocity = 50 + Math.random() * 50;
        const tx = Math.cos(angle) * velocity;
        const ty = Math.sin(angle) * velocity;

        confetti.animate([
          { transform: 'translate(0, 0) rotate(0deg)', opacity: 1 },
          { transform: `translate(${tx}px, ${ty}px) rotate(${Math.random() * 360}deg)`, opacity: 0 }
        ], {
          duration: 600 + Math.random() * 400,
          easing: 'cubic-bezier(0, .9, .57, 1)',
        });

        setTimeout(() => confetti.remove(), 1000);
      }
    }

    function showAddTaskModal() {
      // Populate goal selector
      const select = document.getElementById('taskGoalSelect');
      select.innerHTML = '<option value="">No goal</option>';
      
      dashboardState.goals.forEach(goal => {
        const option = document.createElement('option');
        option.value = goal.id;
        option.textContent = goal.name;
        select.appendChild(option);
      });
      
      document.getElementById('taskNameInput').value = '';
      document.getElementById('addTaskModal').classList.add('active');
      document.getElementById('taskNameInput').focus();
    }

    function closeAddTaskModal() {
      document.getElementById('addTaskModal').classList.remove('active');
    }

    function saveNewTask() {
      const name = document.getElementById('taskNameInput').value.trim();
      const goalId = document.getElementById('taskGoalSelect').value;
      
      if (!name) return;
      
      const newTask = {
        id: generateId(),
        name: name,
        goalId: goalId || null,
        completed: false,
        description: ''
      };
      
      dashboardState.weeklyTasks[currentDay].push(newTask);
      saveDashboard();
      renderTasks();
      closeAddTaskModal();
    }

    function openTaskSidebar(taskId) {
      const task = dashboardState.weeklyTasks[currentDay].find(t => t.id === taskId);
      if (!task) return;
      
      let html = `
        <div class="sidebar-title">Task Details</div>
        
        <div class="sidebar-section">
          <div class="sidebar-label">Task Name</div>
          <input type="text" class="sidebar-input" id="taskName" value="${task.name}" />
        </div>
        
        <div class="sidebar-section">
          <div class="sidebar-label">Description</div>
          <textarea class="sidebar-textarea" id="taskDescription" placeholder="Add description...">${task.description || ''}</textarea>
        </div>
      `;
      
      // Add special buttons based on task type
      if (task.hasJournalingButton) {
        html += `
          <button class="action-btn" onclick="openJournaling('${taskId}')" style="background: #10b981; color: white; margin: 10px 0;">
            üí¨ Start Journaling
          </button>
        `;
      }
      
      if (task.hasFinanceButton) {
        html += `
          <button class="action-btn" onclick="openFinanceSheet()" style="background: #3b82f6; color: white; margin: 10px 0;">
            üìä View Spreadsheet
          </button>
        `;
      }
      
      if (task.hasHairButton) {
        html += `
          <button class="action-btn" onclick="scheduleHairAppointment()" style="background: #ec4899; color: white; margin: 10px 0;">
            üíá‚Äç‚ôÄÔ∏è Schedule Appointment
          </button>
        `;
      }
      
      if (task.hasRestOptions) {
        html += `
          <div class="sidebar-section">
            <div class="sidebar-label">Rest Activities</div>
            <div style="display: flex; flex-direction: column; gap: 8px;">
              <button class="action-btn" onclick="selectRestActivity('massage')" style="background: rgba(0,0,0,0.05); text-align: left;">
                üíÜ‚Äç‚ôÄÔ∏è Book Massage
              </button>
              <button class="action-btn" onclick="selectRestActivity('movie')" style="background: rgba(0,0,0,0.05); text-align: left;">
                üé¨ Movie & Order In
              </button>
              <button class="action-btn" onclick="selectRestActivity('cafe')" style="background: rgba(0,0,0,0.05); text-align: left;">
                ‚òï Nude Cafe Dinner
              </button>
              <button class="action-btn" onclick="selectRestActivity('beach')" style="background: rgba(0,0,0,0.05); text-align: left;">
                üåä Beach Walk
              </button>
            </div>
          </div>
        `;
      }
      
      html += `
        <div class="sidebar-section">
          <div class="sidebar-label">Tag Goal</div>
          <select class="sidebar-select" id="taskGoal">
            <option value="">No goal</option>
          </select>
        </div>
        
        <button class="delete-btn" onclick="deleteTask('${taskId}')">Delete Task</button>
      `;
      
      document.getElementById('sidebarContent').innerHTML = html;
      
      // Populate goal selector
      const select = document.getElementById('taskGoal');
      dashboardState.goals.forEach(goal => {
        const option = document.createElement('option');
        option.value = goal.id;
        option.textContent = goal.name;
        if (task.goalId === goal.id) option.selected = true;
        select.appendChild(option);
      });
      
      // Save handlers
      document.getElementById('taskName').onblur = () => {
        task.name = document.getElementById('taskName').value;
        saveDashboard();
        renderTasks();
      };
      
      document.getElementById('taskDescription').onblur = () => {
        task.description = document.getElementById('taskDescription').value;
        saveDashboard();
      };
      
      document.getElementById('taskGoal').onchange = () => {
        const oldGoalId = task.goalId;
        const newGoalId = document.getElementById('taskGoal').value || null;
        
        // Remove from old goal's task list if exists
        if (oldGoalId && task.goalTaskIndex !== undefined) {
          const oldGoal = dashboardState.goals.find(g => g.id === oldGoalId);
          if (oldGoal && oldGoal.tasks && oldGoal.tasks[task.goalTaskIndex]) {
            oldGoal.tasks[task.goalTaskIndex].scheduledDay = 'none';
          }
        }
        
        // Add to new goal's task list
        if (newGoalId) {
          const newGoal = dashboardState.goals.find(g => g.id === newGoalId);
          if (newGoal) {
            if (!newGoal.tasks) newGoal.tasks = [];
            
            // Check if task already exists in goal
            const existingIndex = newGoal.tasks.findIndex(t => t.name === task.name);
            
            if (existingIndex >= 0) {
              // Update existing task
              newGoal.tasks[existingIndex].scheduledDay = currentDay;
              newGoal.tasks[existingIndex].completed = task.completed;
              task.goalTaskIndex = existingIndex;
            } else {
              // Add new task to goal
              newGoal.tasks.push({
                id: generateId(),
                name: task.name,
                completed: task.completed,
                scheduledDay: currentDay
              });
              task.goalTaskIndex = newGoal.tasks.length - 1;
            }
          }
        } else {
          task.goalTaskIndex = undefined;
        }
        
        task.goalId = newGoalId;
        saveDashboard();
        renderTasks();
      };
      
      document.getElementById('sidebar').classList.add('active');
    }

    function deleteTask(taskId) {
      if (!confirm('Delete this task?')) return;
      
      dashboardState.weeklyTasks[currentDay] = dashboardState.weeklyTasks[currentDay].filter(t => t.id !== taskId);
      saveDashboard();
      renderTasks();
      closeSidebar();
    }

    function closeSidebar() {
      document.getElementById('sidebar').classList.remove('active');
    }

    // Goal Image Modal
    function showGoalImageModal(goalId) {
      const goal = dashboardState.goals.find(g => g.id === goalId);
      if (!goal) return;
      
      currentGoalForImage = goalId;
      selectedGoalImage = goal.image || null;
      
      const grid = document.getElementById('goalVisionGrid');
      grid.innerHTML = '';
      visionImages.forEach(img => {
        const item = document.createElement('div');
        item.className = 'image-grid-item' + (selectedGoalImage === img ? ' selected' : '');
        item.style.backgroundImage = `url('${img}')`;
        item.onclick = () => selectVisionImageForGoal(img);
        grid.appendChild(item);
      });
      
      document.getElementById('goalImagePreview').style.display = 'none';
      document.getElementById('goalUploadPlaceholder').style.display = 'block';
      
      document.getElementById('goalImageModal').classList.add('active');
    }

    function closeGoalImageModal() {
      document.getElementById('goalImageModal').classList.remove('active');
      currentGoalForImage = null;
      selectedGoalImage = null;
    }

    function selectVisionImageForGoal(imageName) {
      selectedGoalImage = imageName;
      
      document.querySelectorAll('#goalVisionGrid .image-grid-item').forEach(item => {
        item.classList.remove('selected');
        if (item.style.backgroundImage.includes(imageName)) {
          item.classList.add('selected');
        }
      });
    }

    function handleGoalImageUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = (e) => {
        selectedGoalImage = e.target.result;
        
        const preview = document.getElementById('goalImagePreview');
        preview.src = selectedGoalImage;
        preview.style.display = 'block';
        document.getElementById('goalUploadPlaceholder').style.display = 'none';
        
        document.querySelectorAll('#goalVisionGrid .image-grid-item').forEach(item => {
          item.classList.remove('selected');
        });
      };
      reader.readAsDataURL(file);
    }

    function saveGoalImage() {
      if (!currentGoalForImage || !selectedGoalImage) {
        closeGoalImageModal();
        return;
      }
      
      const goal = dashboardState.goals.find(g => g.id === currentGoalForImage);
      if (goal) {
        goal.image = selectedGoalImage;
        saveDashboard();
        renderTasks(); // Re-render to update goals in empty state
      }
      
      closeGoalImageModal();
    }

    function showConfetti(element) {
      const rect = element.getBoundingClientRect();
      const x = rect.left + rect.width / 2;
      const y = rect.top + rect.height / 2;

      for (let i = 0; i < 20; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = x + 'px';
        confetti.style.top = y + 'px';
        confetti.style.background = `hsl(${Math.random() * 360}, 70%, 70%)`;
        confetti.style.transform = `translate(${(Math.random() - 0.5) * 100}px, ${(Math.random() - 0.5) * 100}px)`;
        document.body.appendChild(confetti);

        setTimeout(() => confetti.remove(), 1000);
      }
    }

    function saveDashboard() {
      localStorage.setItem('dashboardState', JSON.stringify(dashboardState));
    }

    // Initialize
    initializeDashboard();
    initializeDropZone();
  </script>

</body>
</html>