<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Weekly Dashboard</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      background: #ffffff;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', 'Arial', sans-serif;
      color: #000000;
      overflow-x: hidden;
      min-height: 100vh;
    }

    /* Tab Navigation - Overlay Style (like vision screen) */
    .tab-nav {
      position: fixed;
      top: 30px;
      left: 60px;
      z-index: 100;
      display: flex;
      gap: 30px;
      align-items: center;
    }

    .tab-btn {
      background: transparent;
      border: none;
      color: rgba(0, 0, 0, 0.4);
      font-size: 0.8rem;
      font-weight: 500;
      cursor: pointer;
      padding: 8px 0;
      transition: all 0.3s;
      letter-spacing: 0.5px;
    }

    .tab-btn.active {
      color: #000000;
      border-bottom: 1px solid #000000;
    }

    .tab-btn:hover {
      color: rgba(0, 0, 0, 0.7);
    }

    .tab-actions {
      position: fixed;
      top: 30px;
      right: 60px;
      z-index: 100;
    }

    .nav-btn {
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid rgba(0, 0, 0, 0.1);
      color: rgba(0, 0, 0, 0.7);
      padding: 8px 20px;
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.3s;
      border-radius: 4px;
      font-weight: 500;
      text-decoration: none;
      display: inline-block;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .nav-btn:hover {
      background: #ffffff;
      border-color: rgba(0, 0, 0, 0.2);
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
    }

    /* Tab Content */
    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* GOALS TAB - Full Screen Vision Board Style */
    .goals-container {
      width: 100%;
      height: 100vh;
      padding: 100px 60px 60px;
      overflow-y: auto;
    }

    .goals-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      grid-auto-rows: minmax(150px, 1fr);
      gap: 20px;
      width: 100%;
    }

    /* Vision board style grid layout - first 8 cards get special sizes */
    .goal-card:nth-child(1) { grid-column: span 2; grid-row: span 2; }
    .goal-card:nth-child(2) { grid-column: span 1; grid-row: span 1; }
    .goal-card:nth-child(3) { grid-column: span 2; grid-row: span 1; }
    .goal-card:nth-child(4) { grid-column: span 1; grid-row: span 2; }
    .goal-card:nth-child(5) { grid-column: span 1; grid-row: span 1; }
    .goal-card:nth-child(6) { grid-column: span 1; grid-row: span 1; }
    .goal-card:nth-child(7) { grid-column: span 2; grid-row: span 1; }
    .goal-card:nth-child(8) { grid-column: span 2; grid-row: span 1; }
    /* Remaining items flow naturally */
    .goal-card:nth-child(n+9) { grid-column: span 1; grid-row: span 1; }

    @media (max-width: 1400px) {
      .goals-grid { 
        grid-template-columns: repeat(3, 1fr);
      }
      .goal-card:nth-child(1),
      .goal-card:nth-child(2),
      .goal-card:nth-child(3),
      .goal-card:nth-child(4),
      .goal-card:nth-child(5),
      .goal-card:nth-child(6),
      .goal-card:nth-child(7),
      .goal-card:nth-child(8),
      .goal-card:nth-child(n+9) {
        grid-column: span 1;
        grid-row: span 1;
      }
    }

    @media (max-width: 1000px) {
      .goals-grid { 
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 600px) {
      .goals-grid { 
        grid-template-columns: 1fr;
      }
    }

    .goal-card {
      border-radius: 8px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      background: #f8f8f8;
      animation: gentleFloat 6s ease-in-out infinite;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
      min-height: 200px;
    }

    .goal-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.12);
    }

    .goal-card.has-image {
      background-size: cover;
      background-position: center;
      min-height: 280px;
    }

    .goal-card.no-image {
      min-height: 200px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 40px 30px;
      border: 2px dashed rgba(0, 0, 0, 0.1);
    }

    .goal-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(to top, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0.2) 50%, transparent 100%);
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 1;
    }

    .goal-card.has-image::before {
      opacity: 1;
    }

    .goal-card-content {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 20px;
      z-index: 2;
    }

    .goal-card.no-image .goal-card-content {
      position: static;
      text-align: center;
    }

    .goal-name {
      font-size: 0.85rem;
      font-weight: 500;
      margin-bottom: 6px;
      letter-spacing: -0.2px;
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
      line-height: 1.3;
    }

    .goal-card.has-image .goal-name {
      color: #ffffff;
    }

    .goal-card.no-image .goal-name {
      color: #000000;
    }

    .goal-progress {
      font-size: 0.7rem;
      color: rgba(255, 255, 255, 0.8);
      font-weight: 400;
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
      letter-spacing: 0.3px;
    }

    .goal-card.no-image .goal-progress {
      color: rgba(0, 0, 0, 0.5);
      text-shadow: none;
    }

    .goal-add-image-link {
      font-size: 0.7rem;
      color: rgba(0, 0, 0, 0.4);
      margin-top: 8px;
      display: inline-block;
      transition: all 0.2s;
    }

    .goal-add-image-link:hover {
      color: rgba(0, 0, 0, 0.7);
    }

    .goal-placeholder-icon {
      font-size: 2rem;
      margin-bottom: 12px;
      color: rgba(0, 0, 0, 0.2);
    }

    /* Anchor Cards */
    .anchor-card {
      border-radius: 8px;
      overflow: hidden;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      background: #f8f8f8;
      border: 1px solid rgba(0, 0, 0, 0.08);
      padding: 25px;
      min-height: 160px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      animation: gentleFloat 6s ease-in-out infinite;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
      grid-column: span 1;
      grid-row: span 1;
    }

    .anchor-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.08);
      border-color: rgba(0, 0, 0, 0.15);
    }

    .anchor-name {
      font-size: 0.9rem;
      font-weight: 600;
      margin-bottom: 10px;
      letter-spacing: -0.3px;
      color: #000000;
    }

    .anchor-status {
      font-size: 0.75rem;
      color: rgba(0, 0, 0, 0.5);
      font-weight: 400;
      letter-spacing: 0.3px;
    }

    @keyframes gentleFloat {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }

    /* WEEKLY PLAN TAB - Minimal & Sleek */
    .planner-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 80px 60px 100px;
    }

    .planner-header {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 60px;
      gap: 8px;
    }

    .planner-date-range {
      font-size: 0.75rem;
      color: rgba(0, 0, 0, 0.4);
      letter-spacing: 0.5px;
      font-weight: 400;
    }

    .day-navigation {
      display: flex;
      align-items: center;
      gap: 30px;
    }

    .day-nav-btn {
      background: transparent;
      border: none;
      color: rgba(0, 0, 0, 0.3);
      padding: 8px;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.3s;
      border-radius: 4px;
    }

    .day-nav-btn:hover {
      color: rgba(0, 0, 0, 0.7);
      background: rgba(0, 0, 0, 0.03);
    }

    .current-day {
      font-size: 1.8rem;
      font-weight: 300;
      letter-spacing: -1px;
      color: #000000;
    }

    .tasks-list {
      display: flex;
      flex-direction: column;
      gap: 1px;
      margin-bottom: 40px;
      min-height: 300px;
      background: rgba(0, 0, 0, 0.05);
      border-radius: 8px;
      overflow: hidden;
    }

    .task-item {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 16px 20px;
      background: #ffffff;
      cursor: pointer;
      transition: all 0.2s;
    }

    .task-item:hover {
      background: #fafafa;
    }

    .task-checkbox {
      width: 18px;
      height: 18px;
      cursor: pointer;
      accent-color: #000000;
      flex-shrink: 0;
    }

    .task-content {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .task-name {
      font-size: 0.9rem;
      font-weight: 400;
      color: #000000;
      letter-spacing: -0.2px;
    }

    .task-item.completed .task-name {
      opacity: 0.4;
      text-decoration: line-through;
    }

    .task-goal-badge {
      width: 24px;
      height: 24px;
      border-radius: 4px;
      background-size: cover;
      background-position: center;
      border: 1px solid rgba(0, 0, 0, 0.1);
      flex-shrink: 0;
    }

    .add-task-btn {
      background: #ffffff;
      border: 1px dashed rgba(0, 0, 0, 0.15);
      color: rgba(0, 0, 0, 0.4);
      padding: 16px 20px;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.3s;
      border-radius: 8px;
      width: 100%;
      font-weight: 400;
      letter-spacing: 0.3px;
    }

    .add-task-btn:hover {
      background: #fafafa;
      border-color: rgba(0, 0, 0, 0.25);
      color: rgba(0, 0, 0, 0.7);
    }

    .empty-state {
      text-align: center;
      padding: 80px 20px;
      color: rgba(0, 0, 0, 0.3);
      font-size: 0.9rem;
      font-weight: 300;
    }

    /* Right Sidebar - White Minimal */
    .sidebar {
      position: fixed;
      top: 0;
      right: -450px;
      width: 450px;
      height: 100vh;
      background: #ffffff;
      border-left: 1px solid rgba(0, 0, 0, 0.08);
      padding: 40px 30px;
      overflow-y: auto;
      transition: right 0.3s ease;
      z-index: 200;
      box-shadow: -10px 0 40px rgba(0, 0, 0, 0.08);
    }

    .sidebar.active {
      right: 0;
    }

    .sidebar-close {
      position: absolute;
      top: 20px;
      right: 20px;
      background: transparent;
      border: none;
      color: rgba(0, 0, 0, 0.4);
      font-size: 1.5rem;
      cursor: pointer;
      transition: all 0.2s;
      padding: 5px;
      line-height: 1;
    }

    .sidebar-close:hover {
      color: rgba(0, 0, 0, 0.8);
    }

    .sidebar-title {
      font-size: 1.3rem;
      font-weight: 500;
      margin-bottom: 25px;
      color: #000000;
      letter-spacing: -0.5px;
      padding-right: 30px;
    }

    .sidebar-section {
      margin-bottom: 30px;
    }

    .sidebar-label {
      font-size: 0.7rem;
      color: rgba(0, 0, 0, 0.5);
      margin-bottom: 10px;
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .sidebar-input, .sidebar-textarea, .sidebar-select {
      width: 100%;
      background: #fafafa;
      border: 1px solid rgba(0, 0, 0, 0.08);
      border-radius: 6px;
      padding: 12px 15px;
      color: #000000;
      font-size: 0.9rem;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica', 'Arial', sans-serif;
    }

    .sidebar-textarea {
      min-height: 100px;
      resize: vertical;
    }

    .sidebar-input:focus, .sidebar-textarea:focus, .sidebar-select:focus {
      outline: none;
      border-color: rgba(0, 0, 0, 0.2);
      background: #ffffff;
    }

    .sidebar-image {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 6px;
      margin-bottom: 20px;
    }

    .sidebar-tasks {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .sidebar-task {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      padding: 12px;
      background: #fafafa;
      border: 1px solid rgba(0, 0, 0, 0.06);
      border-radius: 6px;
    }

    .sidebar-task-checkbox {
      margin-top: 2px;
      width: 16px;
      height: 16px;
      cursor: pointer;
      accent-color: #000000;
      flex-shrink: 0;
    }

    .sidebar-task-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .sidebar-task-name {
      font-size: 0.85rem;
      color: #000000;
      line-height: 1.4;
    }

    .sidebar-task.completed .sidebar-task-name {
      opacity: 0.4;
      text-decoration: line-through;
    }

    .sidebar-task-schedule {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .schedule-btn {
      background: rgba(0, 0, 0, 0.05);
      border: 1px solid rgba(0, 0, 0, 0.1);
      color: rgba(0, 0, 0, 0.7);
      padding: 6px 12px;
      font-size: 0.75rem;
      cursor: pointer;
      border-radius: 4px;
      font-weight: 500;
      transition: all 0.2s;
    }

    .schedule-btn:hover {
      background: rgba(0, 0, 0, 0.08);
      border-color: rgba(0, 0, 0, 0.2);
    }

    .schedule-dropdown {
      background: #fafafa;
      border: 1px solid rgba(0, 0, 0, 0.1);
      color: #000000;
      padding: 6px 10px;
      font-size: 0.75rem;
      border-radius: 4px;
      cursor: pointer;
    }

    .schedule-dropdown:focus {
      outline: none;
      border-color: rgba(0, 0, 0, 0.2);
    }

    .add-task-input {
      width: 100%;
      background: #fafafa;
      border: 1px solid rgba(0, 0, 0, 0.08);
      border-radius: 6px;
      padding: 12px 15px;
      color: #000000;
      font-size: 0.85rem;
      margin-top: 12px;
    }

    .add-task-input:focus {
      outline: none;
      border-color: rgba(0, 0, 0, 0.2);
    }

    .add-task-input::placeholder {
      color: rgba(0, 0, 0, 0.3);
    }

    .sidebar-progress {
      font-size: 1rem;
      color: #000000;
      font-weight: 500;
    }

    .delete-btn {
      background: rgba(255, 100, 100, 0.1);
      border: 1px solid rgba(255, 100, 100, 0.3);
      color: rgba(255, 50, 50, 0.9);
      padding: 12px 24px;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.3s;
      border-radius: 6px;
      width: 100%;
      font-weight: 500;
      margin-top: 20px;
    }

    .delete-btn:hover {
      background: rgba(255, 100, 100, 0.15);
      border-color: rgba(255, 100, 100, 0.5);
    }

    /* Modal - White Minimal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(10px);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }

    .modal-overlay.active {
      opacity: 1;
      pointer-events: all;
    }

    .modal-content {
      background: #ffffff;
      border: 1px solid rgba(0, 0, 0, 0.08);
      border-radius: 12px;
      padding: 40px;
      max-width: 500px;
      width: 90%;
      max-height: 85vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
    }

    .modal-title {
      font-size: 1.3rem;
      font-weight: 500;
      margin-bottom: 25px;
      color: #000000;
      letter-spacing: -0.3px;
    }

    .modal-input, .modal-select {
      width: 100%;
      background: #fafafa;
      border: 1px solid rgba(0, 0, 0, 0.08);
      border-radius: 8px;
      padding: 14px 16px;
      color: #000000;
      font-size: 0.95rem;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica', 'Arial', sans-serif;
      margin-bottom: 20px;
    }

    .modal-input:focus, .modal-select:focus {
      outline: none;
      border-color: rgba(0, 0, 0, 0.2);
      background: #ffffff;
    }

    .modal-actions {
      display: flex;
      gap: 12px;
      margin-top: 25px;
    }

    .modal-btn {
      flex: 1;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 500;
      border: none;
      letter-spacing: 0.3px;
    }

    .modal-btn-cancel {
      background: #f5f5f5;
      color: rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(0, 0, 0, 0.08);
    }

    .modal-btn-cancel:hover {
      background: #eeeeee;
    }

    .modal-btn-primary {
      background: #000000;
      color: #ffffff;
    }

    .modal-btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .image-upload-area {
      border: 2px dashed rgba(0, 0, 0, 0.15);
      border-radius: 8px;
      padding: 40px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
      background: #fafafa;
      margin-bottom: 20px;
    }

    .image-upload-area:hover {
      border-color: rgba(0, 0, 0, 0.3);
      background: #f5f5f5;
    }

    .image-upload-area.has-image {
      padding: 0;
      border: 1px solid rgba(0, 0, 0, 0.1);
    }

    .upload-preview {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 6px;
    }

    .upload-placeholder {
      color: rgba(0, 0, 0, 0.4);
      font-size: 0.9rem;
    }

    .upload-icon {
      font-size: 2rem;
      margin-bottom: 10px;
      color: rgba(0, 0, 0, 0.2);
    }

    .image-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }

    .image-grid-item {
      aspect-ratio: 1;
      border-radius: 6px;
      background-size: cover;
      background-position: center;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.3s;
    }

    .image-grid-item:hover {
      border-color: rgba(0, 0, 0, 0.3);
      transform: scale(1.05);
    }

    .image-grid-item.selected {
      border-color: #000000;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
    }

    /* Confetti */
    @keyframes confetti {
      0% { 
        transform: translateY(0) rotate(0deg);
        opacity: 1;
      }
      100% { 
        transform: translateY(-120px) rotate(360deg);
        opacity: 0;
      }
    }

    .confetti {
      position: fixed;
      width: 10px;
      height: 10px;
      background: #000000;
      animation: confetti 1s ease-out forwards;
      pointer-events: none;
      z-index: 9999;
      border-radius: 50%;
    }
  </style>
</head>

<body>
  
  <!-- Tab Navigation - Overlay Style -->
  <div class="tab-nav">
    <button class="tab-btn active" onclick="switchTab('goals')">goals</button>
    <button class="tab-btn" onclick="switchTab('planner')">weekly plan</button>
  </div>
  
  <div class="tab-actions">
    <a href="questionnaire.html" class="nav-btn">← Back to Planner</a>
  </div>

  <!-- GOALS TAB -->
  <div class="tab-content active" id="goalsTab">
    <div class="goals-container">
      <div class="goals-grid" id="goalsGrid">
        <!-- Populated by JavaScript -->
      </div>
    </div>
  </div>

  <!-- WEEKLY PLAN TAB -->
  <div class="tab-content" id="plannerTab">
    <div class="planner-container">
      
      <div class="planner-header">
        <div class="planner-date-range" id="plannerDateRange">Dec 1-7, 2025</div>
        <div class="day-navigation">
          <button class="day-nav-btn" onclick="previousDay()">←</button>
          <div class="current-day" id="currentDayLabel">Monday</div>
          <button class="day-nav-btn" onclick="nextDay()">→</button>
        </div>
      </div>

      <div class="tasks-list" id="tasksList">
        <!-- Populated by JavaScript -->
      </div>

      <button class="add-task-btn" onclick="showAddTaskModal()">+ Add Task</button>

    </div>
  </div>

  <!-- Sidebar (for both tabs) -->
  <div class="sidebar" id="sidebar">
    <button class="sidebar-close" onclick="closeSidebar()">×</button>
    <div id="sidebarContent"></div>
  </div>

  <!-- Add Task Modal -->
  <div class="modal-overlay" id="addTaskModal">
    <div class="modal-content">
      <div class="modal-title">Add Task</div>
      <input type="text" id="taskNameInput" class="modal-input" placeholder="Task name" />
      <div style="margin-bottom: 10px; font-size: 0.85rem; color: rgba(255,255,255,0.5);">Tag a goal (optional):</div>
      <select id="taskGoalSelect" class="modal-select">
        <option value="">No goal</option>
      </select>
      <div class="modal-actions">
        <button class="modal-btn modal-btn-cancel" onclick="closeAddTaskModal()">Cancel</button>
        <button class="modal-btn modal-btn-primary" onclick="saveNewTask()">Add</button>
      </div>
    </div>
  </div>

  <!-- Goal Image Modal -->
  <div class="modal-overlay" id="goalImageModal">
    <div class="modal-content">
      <div class="modal-title">Add Image to Goal</div>
      
      <div class="image-upload-area" id="goalImageUploadArea" onclick="document.getElementById('goalImageInput').click()">
        <div id="goalUploadPlaceholder">
          <div class="upload-icon">+</div>
          <div class="upload-placeholder">Click to upload image</div>
        </div>
        <img id="goalImagePreview" class="upload-preview" style="display: none;" />
      </div>
      <input type="file" id="goalImageInput" accept="image/*" style="display: none;" onchange="handleGoalImageUpload(event)" />

      <div style="margin-bottom: 10px; font-size: 0.85rem; color: rgba(255,255,255,0.5);">Or choose from vision board:</div>
      <div class="image-grid" id="goalVisionGrid"></div>

      <div class="modal-actions">
        <button class="modal-btn modal-btn-cancel" onclick="closeGoalImageModal()">Cancel</button>
        <button class="modal-btn modal-btn-primary" onclick="saveGoalImage()">Save</button>
      </div>
    </div>
  </div>

  <script>
    // Load questionnaire data
    const savedData = JSON.parse(localStorage.getItem('weeklyPlanData') || '{}');
    const questionnaireData = savedData.formData || savedData;
    
    // Load or initialize dashboard state
    let dashboardState = JSON.parse(localStorage.getItem('dashboardState') || 'null');

    // Vision board images
    const visionImages = [
      "badass.jpg", "b.jpg", "stick-to-your-plan.jpg", "powerfulenergy.jpg",
      "goddess.jpg", "gold-flow.jpg", "goodthings.jpg", "pexels-photo-15448063.webp", "spirit.jpg"
    ];

    // State
    let currentTab = 'goals';
    let currentDay = 'monday';
    let currentGoalForImage = null;
    let selectedGoalImage = null;

    function generateId() {
      return 'id_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
    }

    function parseGoalsFromQuestionnaire(goalsText) {
      if (!goalsText) return [];
      
      if (Array.isArray(goalsText)) {
        return goalsText.map(g => ({
          id: generateId(),
          name: typeof g === 'string' ? g : g.name || 'Untitled Goal',
          image: (typeof g === 'object' && g.image) || null,
          description: '',
          tasks: []
        }));
      }
      
      return goalsText.split('\n')
        .filter(g => g.trim())
        .map(name => ({
          id: generateId(),
          name: name.trim(),
          image: null,
          description: '',
          tasks: []
        }));
    }

    // Initialize
    function initializeDashboard() {
      // Check if we need to migrate or reset
      const needsReset = dashboardState && (
        !dashboardState.goals || 
        !dashboardState.weeklyTasks || 
        dashboardState.weeklyBlocks // Old structure detected
      );
      
      if (!dashboardState || needsReset) {
        console.log('Initializing fresh dashboard state');
        dashboardState = {
          goals: [
            ...parseGoalsFromQuestionnaire(questionnaireData.workGoals),
            ...parseGoalsFromQuestionnaire(questionnaireData.lifeGoals)
          ],
          anchors: [
            { id: generateId(), name: 'Workout 2x', count: 0, target: 2 },
            { id: generateId(), name: 'Expenses <$150', amount: 0, target: 150 }
          ],
          weeklyTasks: {
            monday: [],
            tuesday: [],
            wednesday: [],
            thursday: [],
            friday: [],
            saturday: [],
            sunday: []
          }
        };
        saveDashboard();
      }
      
      // Ensure all goals have tasks array
      if (dashboardState.goals) {
        dashboardState.goals = dashboardState.goals.map(goal => ({
          ...goal,
          tasks: goal.tasks || []
        }));
      }
      
      // Ensure weeklyTasks exists and has all days
      if (!dashboardState.weeklyTasks) {
        dashboardState.weeklyTasks = {
          monday: [],
          tuesday: [],
          wednesday: [],
          thursday: [],
          friday: [],
          saturday: [],
          sunday: []
        };
        saveDashboard();
      }

      console.log('Dashboard initialized:', dashboardState);
      renderGoals();
      renderTasks();
    }

    function switchTab(tab) {
      currentTab = tab;
      
      document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
      
      if (tab === 'goals') {
        document.querySelector('.tab-btn:nth-child(1)').classList.add('active');
        document.getElementById('goalsTab').classList.add('active');
        renderGoals();
      } else {
        document.querySelector('.tab-btn:nth-child(2)').classList.add('active');
        document.getElementById('plannerTab').classList.add('active');
        renderTasks();
      }
      
      closeSidebar();
    }

    // GOALS TAB
    function renderGoals() {
      const grid = document.getElementById('goalsGrid');
      if (!grid) return;
      
      grid.innerHTML = '';
      
      // Ensure goals array exists
      if (!dashboardState.goals) {
        dashboardState.goals = [
          ...parseGoalsFromQuestionnaire(questionnaireData.workGoals),
          ...parseGoalsFromQuestionnaire(questionnaireData.lifeGoals)
        ];
        saveDashboard();
      }
      
      // Render goal cards
      dashboardState.goals.forEach(goal => {
        const card = document.createElement('div');
        card.className = 'goal-card';
        
        const completedTasks = goal.tasks ? goal.tasks.filter(t => t.completed).length : 0;
        const totalTasks = goal.tasks ? goal.tasks.length : 0;
        const progress = totalTasks > 0 ? `${completedTasks}/${totalTasks} complete` : 'No tasks yet';
        
        if (goal.image) {
          card.classList.add('has-image');
          card.style.backgroundImage = `url('${goal.image}')`;
          card.innerHTML = `
            <div class="goal-card-content">
              <div class="goal-name">${goal.name}</div>
              <div class="goal-progress">${progress}</div>
            </div>
          `;
        } else {
          card.classList.add('no-image');
          card.innerHTML = `
            <div class="goal-card-content">
              <div class="goal-placeholder-icon">+</div>
              <div class="goal-name">${goal.name}</div>
              <div class="goal-progress">${progress}</div>
              <div class="goal-add-image-link" onclick="event.stopPropagation(); showGoalImageModal('${goal.id}')">Add image</div>
            </div>
          `;
        }
        
        card.onclick = (e) => {
          if (!e.target.classList.contains('goal-add-image-link')) {
            openGoalSidebar(goal.id);
          }
        };
        
        grid.appendChild(card);
      });
      
      // Render anchor cards
      if (dashboardState.anchors) {
        dashboardState.anchors.forEach(anchor => {
          const card = document.createElement('div');
          card.className = 'anchor-card';
          
          let status = '';
          if (anchor.name.includes('Workout')) {
            status = `${anchor.count}/${anchor.target} workouts`;
          } else if (anchor.name.includes('Expenses')) {
            status = `$${anchor.amount}/$${anchor.target}`;
          }
          
          card.innerHTML = `
            <div class="anchor-name">${anchor.name}</div>
            <div class="anchor-status">${status}</div>
          `;
          
          card.onclick = () => openAnchorSidebar(anchor.id);
          
          grid.appendChild(card);
        });
      }
    }

    function openGoalSidebar(goalId) {
      const goal = dashboardState.goals.find(g => g.id === goalId);
      if (!goal) return;
      
      const completedTasks = goal.tasks.filter(t => t.completed).length;
      const totalTasks = goal.tasks.length;
      
      let html = `
        <div class="sidebar-title">${goal.name}</div>
        
        ${goal.image ? `<img src="${goal.image}" class="sidebar-image" />` : ''}
        
        <div class="sidebar-section">
          <div class="sidebar-label">Description</div>
          <textarea class="sidebar-textarea" id="goalDescription" placeholder="Add description...">${goal.description || ''}</textarea>
        </div>
        
        <div class="sidebar-section">
          <div class="sidebar-label">Progress</div>
          <div class="sidebar-progress">${completedTasks}/${totalTasks} tasks complete</div>
        </div>
        
        <div class="sidebar-section">
          <div class="sidebar-label">Tasks</div>
          <div class="sidebar-tasks" id="goalTasks"></div>
          <input type="text" class="add-task-input" id="newGoalTaskInput" placeholder="+ Add task..." onkeypress="handleAddGoalTask(event, '${goalId}')" />
        </div>
        
        <button class="delete-btn" onclick="deleteGoal('${goalId}')">Delete Goal</button>
      `;
      
      document.getElementById('sidebarContent').innerHTML = html;
      
      // Render tasks
      renderGoalTasks(goal);
      
      // Save description on blur
      document.getElementById('goalDescription').onblur = () => {
        goal.description = document.getElementById('goalDescription').value;
        saveDashboard();
      };
      
      document.getElementById('sidebar').classList.add('active');
    }

    function renderGoalTasks(goal) {
      const container = document.getElementById('goalTasks');
      if (!container) return;
      
      container.innerHTML = '';
      
      goal.tasks.forEach((task, index) => {
        const taskEl = document.createElement('div');
        taskEl.className = 'sidebar-task' + (task.completed ? ' completed' : '');
        
        const scheduledDay = task.scheduledDay || 'none';
        
        taskEl.innerHTML = `
          <input type="checkbox" class="sidebar-task-checkbox" ${task.completed ? 'checked' : ''} 
                 onchange="toggleGoalTask('${goal.id}', ${index})" />
          <div class="sidebar-task-content">
            <div class="sidebar-task-name">${task.name}</div>
            <div class="sidebar-task-schedule">
              <span style="font-size: 0.8rem; color: rgba(255,255,255,0.5);">Schedule:</span>
              <select class="schedule-dropdown" onchange="scheduleGoalTask('${goal.id}', ${index}, this.value)">
                <option value="none" ${scheduledDay === 'none' ? 'selected' : ''}>Not scheduled</option>
                <option value="monday" ${scheduledDay === 'monday' ? 'selected' : ''}>Monday</option>
                <option value="tuesday" ${scheduledDay === 'tuesday' ? 'selected' : ''}>Tuesday</option>
                <option value="wednesday" ${scheduledDay === 'wednesday' ? 'selected' : ''}>Wednesday</option>
                <option value="thursday" ${scheduledDay === 'thursday' ? 'selected' : ''}>Thursday</option>
                <option value="friday" ${scheduledDay === 'friday' ? 'selected' : ''}>Friday</option>
                <option value="saturday" ${scheduledDay === 'saturday' ? 'selected' : ''}>Saturday</option>
                <option value="sunday" ${scheduledDay === 'sunday' ? 'selected' : ''}>Sunday</option>
              </select>
            </div>
          </div>
        `;
        
        container.appendChild(taskEl);
      });
    }

    function handleAddGoalTask(e, goalId) {
      if (e.key !== 'Enter') return;
      
      const input = document.getElementById('newGoalTaskInput');
      const taskName = input.value.trim();
      if (!taskName) return;
      
      const goal = dashboardState.goals.find(g => g.id === goalId);
      if (!goal) return;
      
      goal.tasks.push({
        id: generateId(),
        name: taskName,
        completed: false,
        scheduledDay: 'none'
      });
      
      saveDashboard();
      renderGoalTasks(goal);
      renderGoals();
      input.value = '';
    }

    function toggleGoalTask(goalId, taskIndex) {
      const goal = dashboardState.goals.find(g => g.id === goalId);
      if (!goal || !goal.tasks[taskIndex]) return;
      
      goal.tasks[taskIndex].completed = !goal.tasks[taskIndex].completed;
      
      if (goal.tasks[taskIndex].completed) {
        showConfetti(event.target);
      }
      
      // Also update in weekly tasks if scheduled
      const task = goal.tasks[taskIndex];
      if (task.scheduledDay && task.scheduledDay !== 'none') {
        const weeklyTask = dashboardState.weeklyTasks[task.scheduledDay].find(t => t.goalTaskId === task.id);
        if (weeklyTask) {
          weeklyTask.completed = task.completed;
        }
      }
      
      saveDashboard();
      renderGoalTasks(goal);
      renderGoals();
      renderTasks();
    }

    function scheduleGoalTask(goalId, taskIndex, day) {
      const goal = dashboardState.goals.find(g => g.id === goalId);
      if (!goal || !goal.tasks[taskIndex]) return;
      
      const task = goal.tasks[taskIndex];
      const oldDay = task.scheduledDay;
      
      // Remove from old day
      if (oldDay && oldDay !== 'none') {
        dashboardState.weeklyTasks[oldDay] = dashboardState.weeklyTasks[oldDay].filter(t => t.goalTaskId !== task.id);
      }
      
      // Update task
      task.scheduledDay = day;
      
      // Add to new day
      if (day !== 'none') {
        dashboardState.weeklyTasks[day].push({
          id: generateId(),
          name: task.name,
          goalId: goalId,
          goalTaskId: task.id,
          completed: task.completed,
          description: ''
        });
      }
      
      saveDashboard();
      renderGoalTasks(goal);
      renderTasks();
    }

    function deleteGoal(goalId) {
      if (!confirm('Delete this goal and all its tasks?')) return;
      
      dashboardState.goals = dashboardState.goals.filter(g => g.id !== goalId);
      
      // Remove from weekly tasks
      Object.keys(dashboardState.weeklyTasks).forEach(day => {
        dashboardState.weeklyTasks[day] = dashboardState.weeklyTasks[day].filter(t => t.goalId !== goalId);
      });
      
      saveDashboard();
      renderGoals();
      closeSidebar();
    }

    function openAnchorSidebar(anchorId) {
      const anchor = dashboardState.anchors.find(a => a.id === anchorId);
      if (!anchor) return;
      
      let html = '';
      
      if (anchor.name.includes('Workout')) {
        html = `
          <div class="sidebar-title">${anchor.name}</div>
          <div class="sidebar-section">
            <div class="sidebar-label">Current Progress</div>
            <div class="sidebar-progress">${anchor.count}/${anchor.target} workouts</div>
            <button class="schedule-btn" onclick="incrementAnchor('${anchorId}')" style="margin-top: 15px; width: 100%;">+ Log Workout</button>
          </div>
        `;
      } else {
        html = `
          <div class="sidebar-title">${anchor.name}</div>
          <div class="sidebar-section">
            <div class="sidebar-label">Current Spending</div>
            <div class="sidebar-progress">$${anchor.amount}/$${anchor.target}</div>
            <input type="number" class="sidebar-input" id="expenseAmount" placeholder="Enter amount" style="margin-top: 15px;" />
            <button class="schedule-btn" onclick="addExpense('${anchorId}')" style="margin-top: 10px; width: 100%;">Add Expense</button>
          </div>
        `;
      }
      
      document.getElementById('sidebarContent').innerHTML = html;
      document.getElementById('sidebar').classList.add('active');
    }

    function incrementAnchor(anchorId) {
      const anchor = dashboardState.anchors.find(a => a.id === anchorId);
      if (!anchor) return;
      
      anchor.count++;
      saveDashboard();
      renderGoals();
      openAnchorSidebar(anchorId);
    }

    function addExpense(anchorId) {
      const anchor = dashboardState.anchors.find(a => a.id === anchorId);
      const input = document.getElementById('expenseAmount');
      const amount = parseFloat(input.value);
      
      if (!anchor || !amount || amount <= 0) return;
      
      anchor.amount += amount;
      saveDashboard();
      renderGoals();
      openAnchorSidebar(anchorId);
    }

    // WEEKLY PLAN TAB
    function renderTasks() {
      const container = document.getElementById('tasksList');
      if (!container) {
        console.error('tasksList container not found');
        return;
      }
      
      container.innerHTML = '';
      
      console.log('Rendering tasks for:', currentDay);
      console.log('Weekly tasks:', dashboardState.weeklyTasks);
      
      const tasks = dashboardState.weeklyTasks[currentDay] || [];
      console.log('Tasks for', currentDay, ':', tasks);
      
      if (tasks.length === 0) {
        container.innerHTML = '<div class="empty-state">No tasks for today yet</div>';
        updateDayLabel();
        updatePlannerDateRange();
        return;
      }
      
      tasks.forEach(task => {
        const taskEl = document.createElement('div');
        taskEl.className = 'task-item' + (task.completed ? ' completed' : '');
        
        const goal = dashboardState.goals ? dashboardState.goals.find(g => g.id === task.goalId) : null;
        
        taskEl.innerHTML = `
          <input type="checkbox" class="task-checkbox" ${task.completed ? 'checked' : ''} 
                 onchange="toggleWeeklyTask('${task.id}')" />
          <div class="task-content">
            ${goal && goal.image ? `<div class="task-goal-badge" style="background-image: url('${goal.image}')"></div>` : ''}
            <div class="task-name">${task.name}</div>
          </div>
        `;
        
        taskEl.onclick = (e) => {
          if (e.target.type !== 'checkbox') {
            openTaskSidebar(task.id);
          }
        };
        
        container.appendChild(taskEl);
      });
      
      updateDayLabel();
      updatePlannerDateRange();
    }

    function updatePlannerDateRange() {
      const dateRangeEl = document.getElementById('plannerDateRange');
      if (dateRangeEl) {
        dateRangeEl.textContent = getNextWeekDates();
      }
    }

    function getNextWeekDates() {
      const today = new Date();
      const day = today.getDay();
      const diff = today.getDate() + (1 + 7 - day) % 7;
      const nextMonday = new Date(today.setDate(diff));
      const nextSunday = new Date(nextMonday);
      nextSunday.setDate(nextMonday.getDate() + 6);

      const options = { month: "short", day: "numeric", year: "numeric" };
      const start = nextMonday.toLocaleDateString("en-US", { month: "short", day: "numeric" });
      const end = nextSunday.toLocaleDateString("en-US", { month: "short", day: "numeric", year: "numeric" });
      return `${start} - ${end}`;
    }

    function updateDayLabel() {
      const dayNames = {
        monday: 'Monday',
        tuesday: 'Tuesday',
        wednesday: 'Wednesday',
        thursday: 'Thursday',
        friday: 'Friday',
        saturday: 'Saturday',
        sunday: 'Sunday'
      };
      document.getElementById('currentDayLabel').textContent = dayNames[currentDay] || 'Monday';
    }

    function previousDay() {
      const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
      const currentIndex = days.indexOf(currentDay);
      currentDay = days[(currentIndex - 1 + 7) % 7];
      console.log('Previous day:', currentDay);
      renderTasks();
    }

    function nextDay() {
      const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
      const currentIndex = days.indexOf(currentDay);
      currentDay = days[(currentIndex + 1) % 7];
      console.log('Next day:', currentDay);
      renderTasks();
    }

    function toggleWeeklyTask(taskId) {
      const task = dashboardState.weeklyTasks[currentDay].find(t => t.id === taskId);
      if (!task) return;
      
      task.completed = !task.completed;
      
      // Update goal task if linked
      if (task.goalTaskId) {
        const goal = dashboardState.goals.find(g => g.id === task.goalId);
        if (goal) {
          const goalTask = goal.tasks.find(t => t.id === task.goalTaskId);
          if (goalTask) {
            goalTask.completed = task.completed;
          }
        }
      }
      
      if (task.completed) {
        showConfetti(event.target);
      }
      
      saveDashboard();
      renderTasks();
      renderGoals();
    }

    function showAddTaskModal() {
      // Populate goal selector
      const select = document.getElementById('taskGoalSelect');
      select.innerHTML = '<option value="">No goal</option>';
      
      dashboardState.goals.forEach(goal => {
        const option = document.createElement('option');
        option.value = goal.id;
        option.textContent = goal.name;
        select.appendChild(option);
      });
      
      document.getElementById('taskNameInput').value = '';
      document.getElementById('addTaskModal').classList.add('active');
      document.getElementById('taskNameInput').focus();
    }

    function closeAddTaskModal() {
      document.getElementById('addTaskModal').classList.remove('active');
    }

    function saveNewTask() {
      const name = document.getElementById('taskNameInput').value.trim();
      const goalId = document.getElementById('taskGoalSelect').value;
      
      if (!name) return;
      
      const newTask = {
        id: generateId(),
        name: name,
        goalId: goalId || null,
        completed: false,
        description: ''
      };
      
      dashboardState.weeklyTasks[currentDay].push(newTask);
      saveDashboard();
      renderTasks();
      closeAddTaskModal();
    }

    function openTaskSidebar(taskId) {
      const task = dashboardState.weeklyTasks[currentDay].find(t => t.id === taskId);
      if (!task) return;
      
      let html = `
        <div class="sidebar-title">Task Details</div>
        
        <div class="sidebar-section">
          <div class="sidebar-label">Task Name</div>
          <input type="text" class="sidebar-input" id="taskName" value="${task.name}" />
        </div>
        
        <div class="sidebar-section">
          <div class="sidebar-label">Description</div>
          <textarea class="sidebar-textarea" id="taskDescription" placeholder="Add description...">${task.description || ''}</textarea>
        </div>
        
        <div class="sidebar-section">
          <div class="sidebar-label">Tag Goal</div>
          <select class="sidebar-select" id="taskGoal">
            <option value="">No goal</option>
          </select>
        </div>
        
        <button class="delete-btn" onclick="deleteTask('${taskId}')">Delete Task</button>
      `;
      
      document.getElementById('sidebarContent').innerHTML = html;
      
      // Populate goal selector
      const select = document.getElementById('taskGoal');
      dashboardState.goals.forEach(goal => {
        const option = document.createElement('option');
        option.value = goal.id;
        option.textContent = goal.name;
        if (task.goalId === goal.id) option.selected = true;
        select.appendChild(option);
      });
      
      // Save handlers
      document.getElementById('taskName').onblur = () => {
        task.name = document.getElementById('taskName').value;
        saveDashboard();
        renderTasks();
      };
      
      document.getElementById('taskDescription').onblur = () => {
        task.description = document.getElementById('taskDescription').value;
        saveDashboard();
      };
      
      document.getElementById('taskGoal').onchange = () => {
        task.goalId = document.getElementById('taskGoal').value || null;
        saveDashboard();
        renderTasks();
      };
      
      document.getElementById('sidebar').classList.add('active');
    }

    function deleteTask(taskId) {
      if (!confirm('Delete this task?')) return;
      
      dashboardState.weeklyTasks[currentDay] = dashboardState.weeklyTasks[currentDay].filter(t => t.id !== taskId);
      saveDashboard();
      renderTasks();
      closeSidebar();
    }

    function closeSidebar() {
      document.getElementById('sidebar').classList.remove('active');
    }

    // Goal Image Modal
    function showGoalImageModal(goalId) {
      const goal = dashboardState.goals.find(g => g.id === goalId);
      if (!goal) return;
      
      currentGoalForImage = goalId;
      selectedGoalImage = goal.image || null;
      
      const grid = document.getElementById('goalVisionGrid');
      grid.innerHTML = '';
      visionImages.forEach(img => {
        const item = document.createElement('div');
        item.className = 'image-grid-item' + (selectedGoalImage === img ? ' selected' : '');
        item.style.backgroundImage = `url('${img}')`;
        item.onclick = () => selectVisionImageForGoal(img);
        grid.appendChild(item);
      });
      
      document.getElementById('goalImagePreview').style.display = 'none';
      document.getElementById('goalUploadPlaceholder').style.display = 'block';
      
      document.getElementById('goalImageModal').classList.add('active');
    }

    function closeGoalImageModal() {
      document.getElementById('goalImageModal').classList.remove('active');
      currentGoalForImage = null;
      selectedGoalImage = null;
    }

    function selectVisionImageForGoal(imageName) {
      selectedGoalImage = imageName;
      
      document.querySelectorAll('#goalVisionGrid .image-grid-item').forEach(item => {
        item.classList.remove('selected');
        if (item.style.backgroundImage.includes(imageName)) {
          item.classList.add('selected');
        }
      });
    }

    function handleGoalImageUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = (e) => {
        selectedGoalImage = e.target.result;
        
        const preview = document.getElementById('goalImagePreview');
        preview.src = selectedGoalImage;
        preview.style.display = 'block';
        document.getElementById('goalUploadPlaceholder').style.display = 'none';
        
        document.querySelectorAll('#goalVisionGrid .image-grid-item').forEach(item => {
          item.classList.remove('selected');
        });
      };
      reader.readAsDataURL(file);
    }

    function saveGoalImage() {
      if (!currentGoalForImage || !selectedGoalImage) {
        closeGoalImageModal();
        return;
      }
      
      const goal = dashboardState.goals.find(g => g.id === currentGoalForImage);
      if (goal) {
        goal.image = selectedGoalImage;
        saveDashboard();
        renderGoals();
      }
      
      closeGoalImageModal();
    }

    function showConfetti(element) {
      const rect = element.getBoundingClientRect();
      const x = rect.left + rect.width / 2;
      const y = rect.top + rect.height / 2;

      for (let i = 0; i < 20; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = x + 'px';
        confetti.style.top = y + 'px';
        confetti.style.background = `hsl(${Math.random() * 360}, 70%, 70%)`;
        confetti.style.transform = `translate(${(Math.random() - 0.5) * 100}px, ${(Math.random() - 0.5) * 100}px)`;
        document.body.appendChild(confetti);

        setTimeout(() => confetti.remove(), 1000);
      }
    }

    function saveDashboard() {
      localStorage.setItem('dashboardState', JSON.stringify(dashboardState));
    }

    // Initialize
    initializeDashboard();
  </script>

</body>
</html>